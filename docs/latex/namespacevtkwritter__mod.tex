\hypertarget{namespacevtkwritter__mod}{}\section{vtkwritter\+\_\+mod Module Reference}
\label{namespacevtkwritter__mod}\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}


Defines a vtk writer class with an object exposable to the Output streamer. Writes files in .xml vtk, both in serial and parallel model. Uses an unstructured mesh format specifier to store any type of data, both meshes and Tracers. Supports scalar and vectorial data.  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}
\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}{initvtkwritter}} (self)
\begin{DoxyCompactList}\small\item\em Initializes a V\+TK writer object. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}{closevtkwriter}} (self)
\begin{DoxyCompactList}\small\item\em Closes a V\+TK writer object. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_ac11e4d1d71141e6de89ba67508212ce0}{tracerserial}} (self, filename, blocks)
\begin{DoxyCompactList}\small\item\em Public Tracer writting routine. Writes Tracer data in binary X\+ML V\+TK format using an unstructured grid. Serial writer for serial files. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}{indexvtkfile}} (self, filename, timestamp)
\begin{DoxyCompactList}\small\item\em indexes a given file with a correct time stamp in a paraview readable xml format. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}{openindexvtkfile}} (self)
\begin{DoxyCompactList}\small\item\em Open vtu file indexer. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}{closeindexvtkfile}} (self)
\begin{DoxyCompactList}\small\item\em Close vtu file indexer. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}{domain}} (self, filename, bbox, npbbox, blocks)
\begin{DoxyCompactList}\small\item\em Public simulation domain writting routine. Writes binary X\+ML V\+TK format using an unstructured grid. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Defines a vtk writer class with an object exposable to the Output streamer. Writes files in .xml vtk, both in serial and parallel model. Uses an unstructured mesh format specifier to store any type of data, both meshes and Tracers. Supports scalar and vectorial data. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas 
\end{DoxyAuthor}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}\label{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!closeindexvtkfile@{closeindexvtkfile}}
\index{closeindexvtkfile@{closeindexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{closeindexvtkfile()}{closeindexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::closeindexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Close vtu file indexer. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 179 of file vtkwritter.\+f90.


\begin{DoxyCode}
179     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
180     \textcolor{keywordtype}{type}(string) :: outext
181     \textcolor{keywordflow}{if} (self%indexerOpen) \textcolor{keywordflow}{then}
182         outext = \textcolor{stringliteral}{'  </Collection>'}//new\_line(\textcolor{stringliteral}{'a'})
183         outext = outext//\textcolor{stringliteral}{'</VTKFile>'}
184         \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()
185         \textcolor{keyword}{close}(self%indexerUnit)
186 \textcolor{keywordflow}{    end if}    
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}\label{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!closevtkwriter@{closevtkwriter}}
\index{closevtkwriter@{closevtkwriter}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{closevtkwriter()}{closevtkwriter()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::closevtkwriter (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Closes a V\+TK writer object. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 69 of file vtkwritter.\+f90.


\begin{DoxyCode}
69     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
70     \textcolor{keyword}{call }self%CloseIndexVTKFile()
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}\label{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!domain@{domain}}
\index{domain@{domain}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{domain()}{domain()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::domain (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{class(\mbox{\hyperlink{structboundingbox__mod_1_1boundingbox__class}{boundingbox\+\_\+class}}), intent(in)}]{bbox,  }\item[{integer, intent(in)}]{npbbox,  }\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), intent(in)}]{blocks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Public simulation domain writting routine. Writes binary X\+ML V\+TK format using an unstructured grid. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,bbox,npbbox,blocks} & \\
\hline
\mbox{\tt in}  & {\em filename} & name of the case to add\\
\hline
\mbox{\tt in}  & {\em bbox} & Case bounding box\\
\hline
\mbox{\tt in}  & {\em blocks} & Case Blocks\\
\hline
\mbox{\tt in}  & {\em npbbox} & number of points of the bbox geometry \\
\hline
\end{DoxyParams}


Definition at line 197 of file vtkwritter.\+f90.


\begin{DoxyCode}
197     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
198     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
199     \textcolor{keywordtype}{class}(boundingbox\_class), \textcolor{keywordtype}{intent(in)} :: bbox
200     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: blocks
201     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: npbbox
202 
203     \textcolor{keywordtype}{type}(vtk\_file) :: vtkfile
204     \textcolor{keywordtype}{type}(string) :: fullfilename
205     \textcolor{keywordtype}{type}(string) :: outext
206     \textcolor{keywordtype}{integer} :: error, i, b
207     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{parameter} :: nc = 1
208     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(1:npbbox)} :: xx, yy, zz
209     \textcolor{keywordtype}{type}(vector) :: pts(npbbox)
210     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(1:npbbox)} :: connect, var
211     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{dimension(1:nc)} :: offset
212     \textcolor{keywordtype}{integer(I1P)}, \textcolor{keywordtype}{dimension(1:nc)} :: cell\_type
213 
214     offset = [8]
215     cell\_type = [12]
216 
217     \textcolor{comment}{!preparing file}
218     fullfilename = filename%chars()//\textcolor{stringliteral}{'\_BoundingBox.vtu'}
219     outext = \textcolor{stringliteral}{'->Writting Bounding Box file '}//fullfilename
220     \textcolor{keyword}{call }log%put(outext)
221     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//fullfilename
222 
223     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
224 
225     \textcolor{comment}{!Writting bounding box geometry}
226     pts = geometry%getPoints(bbox)
227     \textcolor{keywordflow}{do} i=1, npbbox
228         xx(i) = pts(i)%x
229         yy(i) = pts(i)%y
230         zz(i) = pts(i)%z
231         connect(i) = i-1
232 \textcolor{keywordflow}{    end do}
233     error = vtkfile%xml\_writer%write\_piece(np=npbbox, nc=nc)
234     error = vtkfile%xml\_writer%write\_geo(np=npbbox, nc=nc, x=xx, y=yy, z=zz)
235     error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, cell\_type=
      cell\_type)
236     error = vtkfile%xml\_writer%write\_piece()
237 
238     \textcolor{comment}{!Closing file}
239     error = vtkfile%finalize()
240 
241     \textcolor{comment}{!preparing file}
242     fullfilename = filename%chars()//\textcolor{stringliteral}{'\_Blocks.vtu'}
243     outext = \textcolor{stringliteral}{'->Writting Blocks file '}//fullfilename
244     \textcolor{keyword}{call }log%put(outext)
245     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//fullfilename
246 
247     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
248 
249     \textcolor{comment}{!Writting block geometries}
250     \textcolor{keywordflow}{do} b=1, \textcolor{keyword}{size}(blocks)
251         pts = geometry%getPoints(blocks(b)%extents)
252         \textcolor{keywordflow}{do} i=1, npbbox
253             xx(i) = pts(i)%x
254             yy(i) = pts(i)%y
255             \textcolor{comment}{!zz(i) = pts(i)%z}
256             connect(i) = i-1
257             var(i) = b
258 \textcolor{keywordflow}{        end do}
259         error = vtkfile%xml\_writer%write\_piece(np=npbbox, nc=nc)
260         error = vtkfile%xml\_writer%write\_geo(np=npbbox, nc=nc, x=xx, y=yy, z=zz)
261         error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, cell\_type
      =cell\_type)
262         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'open'})
263         error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'Block'}, x=var)
264         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'close'})
265         error = vtkfile%xml\_writer%write\_piece()
266 \textcolor{keywordflow}{    end do}
267 
268     \textcolor{comment}{!Closing file}
269     error = vtkfile%finalize()
270 
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}\label{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!indexvtkfile@{indexvtkfile}}
\index{indexvtkfile@{indexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{indexvtkfile()}{indexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::indexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{real(prec), intent(in)}]{timestamp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



indexes a given file with a correct time stamp in a paraview readable xml format. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,timestamp} & \\
\hline
\end{DoxyParams}


Definition at line 139 of file vtkwritter.\+f90.


\begin{DoxyCode}
139     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
140     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
141     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: timestamp
142     \textcolor{keywordtype}{type}(string) :: outext, temp
143     
144     \textcolor{keywordflow}{if} (.not. self%indexerOpen) \textcolor{keywordflow}{then}
145         \textcolor{keyword}{call }self%OpenIndexVTKFile()
146 \textcolor{keywordflow}{    end if}
147     temp = timestamp
148     outext = \textcolor{stringliteral}{'<DataSet timestep="'}//temp//\textcolor{stringliteral}{'" file="'}//filename//\textcolor{stringliteral}{'"/>'}
149     \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()
150     
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}\label{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!initvtkwritter@{initvtkwritter}}
\index{initvtkwritter@{initvtkwritter}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{initvtkwritter()}{initvtkwritter()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::initvtkwritter (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Initializes a V\+TK writer object. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 58 of file vtkwritter.\+f90.


\begin{DoxyCode}
58     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
59     self%numVtkFiles = 0
60     self%formatType = \textcolor{stringliteral}{'raw'}
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}\label{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!openindexvtkfile@{openindexvtkfile}}
\index{openindexvtkfile@{openindexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{openindexvtkfile()}{openindexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::openindexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Open vtu file indexer. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 160 of file vtkwritter.\+f90.


\begin{DoxyCode}
160     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
161     \textcolor{keywordtype}{type}(string) :: outext, indexerFilename
162     
163     indexerfilename = globals%Names%outpath//globals%Names%casename//\textcolor{stringliteral}{'.pvd'}
164     \textcolor{keyword}{open}(unit=self%indexerUnit,file=indexerfilename%chars(),action=\textcolor{stringliteral}{"write"},status=\textcolor{stringliteral}{"replace"})    
165     outext = \textcolor{stringliteral}{'<VTKFile type="Collection" version="0.1" byte\_order="LittleEndian">'}//new\_line(\textcolor{stringliteral}{'a'})
166     outext = outext//\textcolor{stringliteral}{'  <Collection>'}    
167     \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()    
168     self%indexerOpen = .true.
169     
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_ac11e4d1d71141e6de89ba67508212ce0}\label{namespacevtkwritter__mod_ac11e4d1d71141e6de89ba67508212ce0}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!tracerserial@{tracerserial}}
\index{tracerserial@{tracerserial}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{tracerserial()}{tracerserial()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::tracerserial (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), intent(in)}]{blocks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Public Tracer writting routine. Writes Tracer data in binary X\+ML V\+TK format using an unstructured grid. Serial writer for serial files. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,blocks} & \\
\hline
\mbox{\tt in}  & {\em blocks} & Case Blocks \\
\hline
\end{DoxyParams}


Definition at line 81 of file vtkwritter.\+f90.


\begin{DoxyCode}
81     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
82     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
83     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: blocks
84 
85     \textcolor{keywordtype}{type}(vtk\_file) :: vtkfile
86     \textcolor{keywordtype}{type}(string) :: fullfilename, extfilename
87     \textcolor{keywordtype}{type}(string) :: outext
88     \textcolor{keywordtype}{integer} :: error, i
89     \textcolor{keywordtype}{integer} :: np
90     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{parameter} :: nc = 0
91     \textcolor{keywordtype}{integer(I1P)}, \textcolor{keywordtype}{dimension(1:nc)} :: cell\_type
92     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{dimension(1:nc)} :: offset
93     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: connect
94     \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: active
95 
96     extfilename = filename%chars()//\textcolor{stringliteral}{'.vtu'}
97     \textcolor{comment}{!outext = '->Writting output file '//extfilename}
98     \textcolor{comment}{!call Log%put(outext)}
99     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//extfilename
100 
101     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
102     \textcolor{comment}{!Write the data of each block}
103     \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(blocks)
104         \textcolor{keywordflow}{if} (blocks(i)%LTracer%getSize() > 0) \textcolor{keywordflow}{then}
105             \textcolor{keyword}{allocate}(active(blocks(i)%LTracer%getSize()))
106             active = blocks(i)%getSVActive()
107             np = count(active)
108             \textcolor{keyword}{allocate}(connect(np))
109             error = vtkfile%xml\_writer%write\_piece(np=np, nc=nc)
110             error = vtkfile%xml\_writer%write\_geo(np=np, nc=nc, x=pack(blocks(i)%getSVvar(1), active), y=
      pack(blocks(i)%getSVvar(2), active), z=pack(blocks(i)%getSVvar(3), active))
111             error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, 
      cell\_type=cell\_type)
112             error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'open'})            
113             error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'id'}, x=pack(blocks(i)%getSVId(), active))
114             error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'source'}, x=pack(blocks(i)%getSVSource(), 
      active))
115             \textcolor{comment}{!error = vtkfile%xml\_writer%write\_dataarray(data\_name='landMask',
       x=pack(blocks(i)%AoT%landMask, blocks(i)%AoT%active))}
116             error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'landIntMask'}, x=pack(blocks(i)
      %getSVlandIntMask(), active))
117             error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'velocity'}, x=pack(blocks(i)%getSVvar(4), 
      active), y=pack(blocks(i)%getSVvar(5), active), z=pack(blocks(i)%getSVvar(6), active))
118             error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'close'})
119             error = vtkfile%xml\_writer%write\_piece()
120             \textcolor{keyword}{deallocate}(connect)
121             \textcolor{keyword}{deallocate}(active)
122 \textcolor{keywordflow}{        end if}
123 \textcolor{keywordflow}{    end do}
124     error = vtkfile%finalize()
125     self%numVtkFiles = self%numVtkFiles + 1
126     
127     \textcolor{keywordflow}{if} (self%numVtkFiles /= 1) \textcolor{keyword}{call }self%IndexVTKFile(extfilename, globals%SimTime%getDateTimeStamp())
128 
\end{DoxyCode}
