\hypertarget{namespacevtkwritter__mod}{}\section{vtkwritter\+\_\+mod Module Reference}
\label{namespacevtkwritter__mod}\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}


Defines a vtk writer class with an object exposable to the Output streamer. Writes files in .xml vtk, both in serial and parallel model. Uses an unstructured mesh format specifier to store any type of data, both meshes and Tracers. Supports scalar and vectorial data.  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}
\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}{initvtkwritter}} (self)
\begin{DoxyCompactList}\small\item\em Initializes a V\+TK writer object. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}{closevtkwriter}} (self)
\begin{DoxyCompactList}\small\item\em Closes a V\+TK writer object. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_abe9e092f90713f5e00585f915fe86c2c}{tracerserial}} (self, filename, num\+Tracers, blocks, output\+Vars)
\begin{DoxyCompactList}\small\item\em Public Tracer writting routine. Writes Tracer data in binary X\+ML V\+TK format using an unstructured grid. Serial writer for serial files. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}{indexvtkfile}} (self, filename, timestamp)
\begin{DoxyCompactList}\small\item\em indexes a given file with a correct time stamp in a paraview readable xml format. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}{openindexvtkfile}} (self)
\begin{DoxyCompactList}\small\item\em Open vtu file indexer. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}{closeindexvtkfile}} (self)
\begin{DoxyCompactList}\small\item\em Close vtu file indexer. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}{domain}} (self, filename, bbox, npbbox, blocks)
\begin{DoxyCompactList}\small\item\em Public simulation domain writting routine. Writes binary X\+ML V\+TK format using an unstructured grid. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Defines a vtk writer class with an object exposable to the Output streamer. Writes files in .xml vtk, both in serial and parallel model. Uses an unstructured mesh format specifier to store any type of data, both meshes and Tracers. Supports scalar and vectorial data. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas 
\end{DoxyAuthor}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}\label{namespacevtkwritter__mod_a6f9a731d9dee5651f85d4aeed3f3ea5d}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!closeindexvtkfile@{closeindexvtkfile}}
\index{closeindexvtkfile@{closeindexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{closeindexvtkfile()}{closeindexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::closeindexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Close vtu file indexer. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 233 of file vtkwritter.\+f90.


\begin{DoxyCode}
233     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
234     \textcolor{keywordtype}{type}(string) :: outext
235     \textcolor{keywordflow}{if} (self%indexerOpen) \textcolor{keywordflow}{then}
236         outext = \textcolor{stringliteral}{'  </Collection>'}//new\_line(\textcolor{stringliteral}{'a'})
237         outext = outext//\textcolor{stringliteral}{'</VTKFile>'}
238         \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()
239         \textcolor{keyword}{close}(self%indexerUnit)
240 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}\label{namespacevtkwritter__mod_a13f1b870d2367704bcd4143a80b552f9}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!closevtkwriter@{closevtkwriter}}
\index{closevtkwriter@{closevtkwriter}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{closevtkwriter()}{closevtkwriter()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::closevtkwriter (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Closes a V\+TK writer object. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 69 of file vtkwritter.\+f90.


\begin{DoxyCode}
69     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
70     \textcolor{keyword}{call }self%CloseIndexVTKFile()
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}\label{namespacevtkwritter__mod_a9f44d9fd1c5da759c4f2d721d12a8181}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!domain@{domain}}
\index{domain@{domain}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{domain()}{domain()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::domain (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{class(\mbox{\hyperlink{structboundingbox__mod_1_1boundingbox__class}{boundingbox\+\_\+class}}), intent(in)}]{bbox,  }\item[{integer, intent(in)}]{npbbox,  }\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), intent(in)}]{blocks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Public simulation domain writting routine. Writes binary X\+ML V\+TK format using an unstructured grid. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,bbox,npbbox,blocks} & \\
\hline
\mbox{\tt in}  & {\em filename} & name of the case to add\\
\hline
\mbox{\tt in}  & {\em bbox} & Case bounding box\\
\hline
\mbox{\tt in}  & {\em blocks} & Case Blocks\\
\hline
\mbox{\tt in}  & {\em npbbox} & number of points of the bbox geometry \\
\hline
\end{DoxyParams}


Definition at line 251 of file vtkwritter.\+f90.


\begin{DoxyCode}
251     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
252     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
253     \textcolor{keywordtype}{class}(boundingbox\_class), \textcolor{keywordtype}{intent(in)} :: bbox
254     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: blocks
255     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: npbbox
256 
257     \textcolor{keywordtype}{type}(vtk\_file) :: vtkfile
258     \textcolor{keywordtype}{type}(string) :: fullfilename
259     \textcolor{keywordtype}{type}(string) :: outext
260     \textcolor{keywordtype}{integer} :: error, i, b
261     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{parameter} :: nc = 1
262     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(1:npbbox)} :: xx, yy, zz
263     \textcolor{keywordtype}{type}(vector) :: pts(npbbox)
264     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(1:npbbox)} :: connect, var
265     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{dimension(1:nc)} :: offset
266     \textcolor{keywordtype}{integer(I1P)}, \textcolor{keywordtype}{dimension(1:nc)} :: cell\_type
267 
268     offset = [8]
269     cell\_type = [12]
270 
271     \textcolor{comment}{!preparing file}
272     fullfilename = filename%chars()//\textcolor{stringliteral}{'\_BoundingBox.vtu'}
273     outext = \textcolor{stringliteral}{'->Writting Bounding Box file '}//fullfilename
274     \textcolor{keyword}{call }log%put(outext)
275     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//fullfilename
276 
277     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
278     \textcolor{comment}{!Writting bounding box geometry}
279     pts = geometry%getPoints(bbox)
280     \textcolor{keywordflow}{do} i=1, npbbox
281         xx(i) = pts(i)%x
282         yy(i) = pts(i)%y
283         zz(i) = pts(i)%z
284         connect(i) = i-1
285 \textcolor{keywordflow}{    end do}
286     error = vtkfile%xml\_writer%write\_piece(np=npbbox, nc=nc)
287     error = vtkfile%xml\_writer%write\_geo(np=npbbox, nc=nc, x=xx, y=yy, z=zz)
288     error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, cell\_type=
      cell\_type)
289     error = vtkfile%xml\_writer%write\_piece()
290     \textcolor{comment}{!Closing file}
291     error = vtkfile%finalize()
292     \textcolor{comment}{!preparing file}
293     fullfilename = filename%chars()//\textcolor{stringliteral}{'\_Blocks.vtu'}
294     outext = \textcolor{stringliteral}{'->Writting Blocks file '}//fullfilename
295     \textcolor{keyword}{call }log%put(outext)
296     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//fullfilename
297 
298     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
299     \textcolor{comment}{!Writting block geometries}
300     \textcolor{keywordflow}{do} b=1, \textcolor{keyword}{size}(blocks)
301         pts = geometry%getPoints(blocks(b)%extents)
302         \textcolor{keywordflow}{do} i=1, npbbox
303             xx(i) = pts(i)%x
304             yy(i) = pts(i)%y
305             \textcolor{comment}{!zz(i) = pts(i)%z}
306             connect(i) = i-1
307             var(i) = b
308 \textcolor{keywordflow}{        end do}
309         error = vtkfile%xml\_writer%write\_piece(np=npbbox, nc=nc)
310         error = vtkfile%xml\_writer%write\_geo(np=npbbox, nc=nc, x=xx, y=yy, z=zz)
311         error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, cell\_type
      =cell\_type)
312         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'open'})
313         error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'Block'}, x=var)
314         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'close'})
315         error = vtkfile%xml\_writer%write\_piece()
316 \textcolor{keywordflow}{    end do}
317     \textcolor{comment}{!Closing file}
318     error = vtkfile%finalize()
319 
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}\label{namespacevtkwritter__mod_a4c50b52b496bad6b053ffd5749da1582}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!indexvtkfile@{indexvtkfile}}
\index{indexvtkfile@{indexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{indexvtkfile()}{indexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::indexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{real(prec), intent(in)}]{timestamp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



indexes a given file with a correct time stamp in a paraview readable xml format. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,timestamp} & \\
\hline
\end{DoxyParams}


Definition at line 193 of file vtkwritter.\+f90.


\begin{DoxyCode}
193     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
194     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
195     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: timestamp
196     \textcolor{keywordtype}{type}(string) :: outext, temp
197 
198     \textcolor{keywordflow}{if} (.not. self%indexerOpen) \textcolor{keywordflow}{then}
199         \textcolor{keyword}{call }self%OpenIndexVTKFile()
200 \textcolor{keywordflow}{    end if}
201     temp = timestamp
202     outext = \textcolor{stringliteral}{'<DataSet timestep="'}//temp//\textcolor{stringliteral}{'" file="'}//filename//\textcolor{stringliteral}{'"/>'}
203     \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()
204 
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}\label{namespacevtkwritter__mod_abd35d591c8e15730a277b2d26deb83e8}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!initvtkwritter@{initvtkwritter}}
\index{initvtkwritter@{initvtkwritter}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{initvtkwritter()}{initvtkwritter()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::initvtkwritter (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Initializes a V\+TK writer object. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 58 of file vtkwritter.\+f90.


\begin{DoxyCode}
58     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
59     self%numVtkFiles = 0
60     self%formatType = \textcolor{stringliteral}{'raw'}
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}\label{namespacevtkwritter__mod_a0c26bb22a8b7dd9f9da69309ad65d669}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!openindexvtkfile@{openindexvtkfile}}
\index{openindexvtkfile@{openindexvtkfile}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{openindexvtkfile()}{openindexvtkfile()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::openindexvtkfile (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Open vtu file indexer. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 214 of file vtkwritter.\+f90.


\begin{DoxyCode}
214     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
215     \textcolor{keywordtype}{type}(string) :: outext, indexerFilename
216 
217     indexerfilename = globals%Names%outpath//globals%Names%casename//\textcolor{stringliteral}{'.pvd'}
218     \textcolor{keyword}{open}(unit=self%indexerUnit,file=indexerfilename%chars(),action=\textcolor{stringliteral}{"write"},status=\textcolor{stringliteral}{"replace"})
219     outext = \textcolor{stringliteral}{'<VTKFile type="Collection" version="0.1" byte\_order="LittleEndian">'}//new\_line(\textcolor{stringliteral}{'a'})
220     outext = outext//\textcolor{stringliteral}{'  <Collection>'}
221     \textcolor{keyword}{write}(self%indexerUnit,\textcolor{stringliteral}{"(A)"}) outext%chars()
222     self%indexerOpen = .true.
223 
\end{DoxyCode}
\mbox{\Hypertarget{namespacevtkwritter__mod_abe9e092f90713f5e00585f915fe86c2c}\label{namespacevtkwritter__mod_abe9e092f90713f5e00585f915fe86c2c}} 
\index{vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}!tracerserial@{tracerserial}}
\index{tracerserial@{tracerserial}!vtkwritter\+\_\+mod@{vtkwritter\+\_\+mod}}
\subsubsection{\texorpdfstring{tracerserial()}{tracerserial()}}
{\footnotesize\ttfamily subroutine vtkwritter\+\_\+mod\+::tracerserial (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structvtkwritter__mod_1_1vtkwritter__class}{vtkwritter\+\_\+class}}), intent(inout)}]{self,  }\item[{type(string), intent(in)}]{filename,  }\item[{integer, intent(in)}]{num\+Tracers,  }\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), intent(in)}]{blocks,  }\item[{type(string), dimension(\+:), intent(in)}]{output\+Vars }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Public Tracer writting routine. Writes Tracer data in binary X\+ML V\+TK format using an unstructured grid. Serial writer for serial files. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,filename,num\+Tracers,blocks,output\+Vars} & \\
\hline
\mbox{\tt in}  & {\em blocks} & Case Blocks \\
\hline
\end{DoxyParams}


Definition at line 81 of file vtkwritter.\+f90.


\begin{DoxyCode}
81     \textcolor{keywordtype}{class}(vtkwritter\_class), \textcolor{keywordtype}{intent(inout)} :: self
82     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{intent(in)} :: filename
83     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: numTracers
84     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: blocks
85     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: outputVars
86 
87     \textcolor{keywordtype}{type}(vtk\_file) :: vtkfile
88     \textcolor{keywordtype}{type}(string) :: fullfilename, extfilename
89     \textcolor{keywordtype}{type}(string) :: outext, tag
90     \textcolor{keywordtype}{integer} :: error, i, j, b, nf
91     \textcolor{keywordtype}{integer} :: np
92     \textcolor{keywordtype}{integer} :: nc
93     \textcolor{keywordtype}{integer(I1P)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: cell\_type
94     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: offset
95     \textcolor{keywordtype}{integer(I4P)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: connect
96     \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: active
97     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: fillValue
98     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: ghostNode
99 
100     extfilename = filename%chars()//\textcolor{stringliteral}{'.vtu'}
101     fullfilename = globals%Names%outpath//\textcolor{stringliteral}{'/'}//extfilename
102 
103     error = vtkfile%initialize(format=self%formatType%chars(), filename=fullfilename%chars(), mesh\_topology
      =\textcolor{stringliteral}{'UnstructuredGrid'})
104     \textcolor{keywordflow}{if} (numtracers > 0) \textcolor{keywordflow}{then}        
105         \textcolor{comment}{!Write the data of each block}
106         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(blocks)
107             \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(blocks(i)%BlockState)) \textcolor{keywordflow}{then}
108                 \textcolor{keywordflow}{do} b = 1, \textcolor{keyword}{size}(blocks(i)%BlockState)
109                     \textcolor{keyword}{allocate}(active(\textcolor{keyword}{size}(blocks(i)%BlockState(b)%active)))
110                     \textcolor{keyword}{allocate}(fillvalue(\textcolor{keyword}{size}(blocks(i)%BlockState(b)%active)))
111                     active = blocks(i)%BlockState(b)%active
112                     fillvalue = mv
113                     np = count(active)
114                     nc = np
115                     \textcolor{keyword}{allocate}(connect(nc))
116                     \textcolor{keyword}{allocate}(offset(nc))
117                     \textcolor{keyword}{allocate}(cell\_type(nc))
118                     cell\_type = 1
119                     \textcolor{keywordflow}{do} j = 1, nc
120                         connect(j) = j-1
121                         offset(j) = j-1
122 \textcolor{keywordflow}{                    end do}
123 
124                     error = vtkfile%xml\_writer%write\_piece(np=np, nc=nc)
125                     error = vtkfile%xml\_writer%write\_geo(np=np, nc=nc, x=pack(blocks(i)%BlockState(b)%state
      (:,1), active), y=pack(blocks(i)%BlockState(b)%state(:,2), active), z=pack(blocks(i)%BlockState(b)%state(:,3
      ), active))
126                     error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=
      offset, cell\_type=cell\_type)
127                     error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'open'})
128 
129                     \textcolor{comment}{!mandatory variables to output}
130                     error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'id'}, x=pack(blocks(i)%BlockState(
      b)%id, active))
131                     error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'source'}, x=pack(blocks(i)
      %BlockState(b)%source, active))
132                     error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'velocity'}, x=pack(blocks(i)
      %BlockState(b)%state(:,4), active), y=pack(blocks(i)%BlockState(b)%state(:,5), active), z=pack(blocks(i)
      %BlockState(b)%state(:,6), active))
133                     error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'state'}, x=pack(blocks(i)
      %BlockState(b)%landIntMask, active))
134                     \textcolor{comment}{!error = vtkfile%xml\_writer%write\_dataarray(data\_name='resolution',
       x=pack(blocks(i)%BlockState(b)%resolution, active))}
135 
136                     \textcolor{comment}{!optional variables to output}
137                     \textcolor{keywordflow}{do} j = 1, \textcolor{keyword}{size}(outputvars)
138                         tag = outputvars(j)
139                         nf = utils%find\_str(blocks(i)%BlockState(b)%varName, tag, .false.)
140                         \textcolor{keywordflow}{if} (nf /= mv\_int) error = vtkfile%xml\_writer%write\_dataarray(data\_name=tag%chars(),
       x=pack(blocks(i)%BlockState(b)%state(:,nf), active))
141                         \textcolor{keywordflow}{if} (nf == mv\_int) error = vtkfile%xml\_writer%write\_dataarray(data\_name=tag%chars(),
       x=pack(fillvalue, active))
142 \textcolor{keywordflow}{                    end do}
143 
144                     error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'close'})
145                     error = vtkfile%xml\_writer%write\_piece()
146                     \textcolor{keyword}{deallocate}(active)
147                     \textcolor{keyword}{deallocate}(fillvalue)
148                     \textcolor{keyword}{deallocate}(connect)
149                     \textcolor{keyword}{deallocate}(offset)
150                     \textcolor{keyword}{deallocate}(cell\_type)
151 \textcolor{keywordflow}{                end do}
152 \textcolor{keywordflow}{            end if}
153 \textcolor{keywordflow}{        end do}
154     \textcolor{keywordflow}{else}
155         np = \textcolor{keyword}{size}(globals%Sources%sourcesID)
156         nc = np
157         \textcolor{keyword}{allocate}(connect(nc))
158         \textcolor{keyword}{allocate}(offset(nc))
159         \textcolor{keyword}{allocate}(cell\_type(nc))
160         cell\_type = 1
161         \textcolor{keywordflow}{do} j = 1, nc
162             connect(j) = j-1
163             offset(j) = j-1
164 \textcolor{keywordflow}{        end do}
165         \textcolor{keyword}{allocate}(ghostnode(np))
166         ghostnode = 0.0
167         error = vtkfile%xml\_writer%write\_piece(np=np, nc=nc)
168         error = vtkfile%xml\_writer%write\_geo(np=np, nc=nc, x=ghostnode, y=ghostnode, z=ghostnode)
169         error = vtkfile%xml\_writer%write\_connectivity(nc=nc, connectivity=connect, offset=offset, cell\_type
      =cell\_type)
170         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'open'})
171         error = vtkfile%xml\_writer%write\_dataarray(data\_name=\textcolor{stringliteral}{'source'}, x=globals%Sources%sourcesID)
172         error = vtkfile%xml\_writer%write\_dataarray(location=\textcolor{stringliteral}{'node'}, action=\textcolor{stringliteral}{'close'})
173         error = vtkfile%xml\_writer%write\_piece()
174         \textcolor{keyword}{deallocate}(ghostnode)        
175         \textcolor{keyword}{deallocate}(connect)
176         \textcolor{keyword}{deallocate}(offset)
177         \textcolor{keyword}{deallocate}(cell\_type)
178 \textcolor{keywordflow}{    end if}
179     error = vtkfile%finalize()
180     self%numVtkFiles = self%numVtkFiles + 1
181 
182     \textcolor{keywordflow}{if} (self%numVtkFiles /= 1) \textcolor{keyword}{call }self%IndexVTKFile(extfilename, globals%SimTime%getDateTimeStamp())
183 
\end{DoxyCode}
