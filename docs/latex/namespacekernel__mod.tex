\hypertarget{namespacekernel__mod}{}\section{kernel\+\_\+mod Module Reference}
\label{namespacekernel__mod}\index{kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}
\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_ae17673ed6d32a4e7f6e54276e6430cc9}{runkernel}} (self, sv, bdata, time, dt)
\begin{DoxyCompactList}\small\item\em Adaptation from run\+Solver (Ricardo) method that evaluates the specific kernel, according to the selected kernel. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacekernel__mod_a1032cd0a40cff8301fcf2ca880c81039}{setcommonprocesses}} (self, sv, bdata, time)
\begin{DoxyCompactList}\small\item\em Sets the state vector land interaction mask values and corrects for maximum level of tracers. Accounts for global periodicity. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_a7a181eab538ac32b3bddcf4bb34503bd}{lagrangiankinematic}} (self, sv, bdata, time)
\begin{DoxyCompactList}\small\item\em Lagrangian Kernel, evaluate the velocities at given points using the interpolants and split the evaluation part from the solver module. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_a69811135e6a881c537873c59451f689e}{stokesdrift}} (self, sv, bdata, time)
\begin{DoxyCompactList}\small\item\em Computes the influence of wave velocity in tracer kinematics. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_ae9cf0f11335d49476ce48a37c2fbde83}{windage}} (self, sv, bdata, time)
\begin{DoxyCompactList}\small\item\em Computes the influence of wind velocity in tracer kinematics. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_ad243eaeb4e5d667795477e81ce6136c9}{beaching}} (self, sv, sv\+Dt)
\begin{DoxyCompactList}\small\item\em Beaching Kernel, uses the already updated state vector and determines if and how beaching occurs. Affects the state vector and state vector derivative. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_ac2352f3964b072607ed042e70a59b9f2}{aging}} (self, sv)
\begin{DoxyCompactList}\small\item\em Aging kernel. Sets the age variable to be updated by dt by the solver. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_a065d7965d3a572a524cfd6bdd4729898}{diffusionmixinglength}} (self, sv, bdata, time, dt)
\begin{DoxyCompactList}\small\item\em mixing length diffusion kernel, computes random velocities at given instants to model diffusion processes. These are valid while the tracer travels a given mixing length, propotional to the resolution of the background (and its ability to resove motion scales) \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_a92805ef71e30527b27de4efd7561f8f7}{diffusionisotropic}} (self, sv, dt)
\begin{DoxyCompactList}\small\item\em Diffusion Kernel, computes the anisotropic diffusion assuming a constant diffusion coefficient. D = 1 m/s. \end{DoxyCompactList}\item 
real(prec) function, dimension(size(sv\%state, 1), size(sv\%state, 2)) \mbox{\hyperlink{namespacekernel__mod_a43899c5dd3f82ed3dc4aade9aefd7a44}{degradationlinear}} (self, sv)
\begin{DoxyCompactList}\small\item\em Linear degradation kernel. \end{DoxyCompactList}\item 
logical function \mbox{\hyperlink{namespacekernel__mod_a4444d73e7295ba4b58add9b726de3135}{hasrequiredvars}} (self, var\+List, req\+Vars)
\begin{DoxyCompactList}\small\item\em returns true if a given set of strings (array) is contained in a list of strings \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacekernel__mod_a26c62a8eec723402e20142e68ba7ec65}{initkernel}} (self)
\begin{DoxyCompactList}\small\item\em Initializer method adpated from for solver kernel class. Sets the type of kernel and the interpolator to evaluate it. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacekernel__mod_ac2352f3964b072607ed042e70a59b9f2}\label{namespacekernel__mod_ac2352f3964b072607ed042e70a59b9f2}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!aging@{aging}}
\index{aging@{aging}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{aging()}{aging()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::aging (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(in)}]{self,  }\item[{type(statevector\+\_\+class), intent(in)}]{sv }\end{DoxyParamCaption})}



Aging kernel. Sets the age variable to be updated by dt by the solver. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv} & \\
\hline
\end{DoxyParams}


Definition at line 360 of file kernel.\+f90.


\begin{DoxyCode}
360     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(in)} :: self
361     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(in)} :: sv
362     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: Aging
363     \textcolor{keywordtype}{integer} :: nf
364     \textcolor{keywordtype}{type}(string) :: tag
365 
366     aging = 0.0
367     tag = \textcolor{stringliteral}{'age'}
368     nf = utils%find\_str(sv%varName, tag, .true.)
369     \textcolor{comment}{!setting the age variable to be updated by dt by the solver for all tracers}
370     \textcolor{comment}{!effectively, we're just setting the derivative of 'age' to be 1.0 :)}
371     aging(:,nf) = 1.0
372 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_ad243eaeb4e5d667795477e81ce6136c9}\label{namespacekernel__mod_ad243eaeb4e5d667795477e81ce6136c9}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!beaching@{beaching}}
\index{beaching@{beaching}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{beaching()}{beaching()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::beaching (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv,  }\item[{real(prec), dimension(size(sv\%state,1),size(sv\%state,2)), intent(in)}]{sv\+Dt }\end{DoxyParamCaption})}



Beaching Kernel, uses the already updated state vector and determines if and how beaching occurs. Affects the state vector and state vector derivative. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,sv\+Dt} & \\
\hline
\end{DoxyParams}


Definition at line 320 of file kernel.\+f90.


\begin{DoxyCode}
320     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
321     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
322     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))}, \textcolor{keywordtype}{intent(in)} :: svDt
323     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: Beaching
324     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1))} :: beachCoeff
325     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1))} :: beachCoeffRand
326     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1))} :: beachWeight
327     \textcolor{keywordtype}{real(prec)} :: lbound, ubound
328     \textcolor{keywordtype}{integer} :: i
329 
330     beachcoeff = 1.0
331     \textcolor{keyword}{call }random\_number(beachcoeffrand) \textcolor{comment}{!this is a uniform distribution generator}
332     beachcoeffrand = max(0.0, beachcoeffrand - globals%Constants%BeachingStopProb)  \textcolor{comment}{!clipping the last % to
       zero}
333     beachcoeffrand = beachcoeffrand*(1.0/max(maxval(beachcoeffrand),1.0)) \textcolor{comment}{!normalizing}
334 
335     beaching = svdt
336 
337     \textcolor{comment}{!getting the bounds for the interpolation of the land interaction field that correspond to beaching}
338     lbound = (globals%Mask%beachVal + globals%Mask%waterVal)*0.5
339     ubound = (globals%Mask%beachVal + globals%Mask%landVal)*0.5
340 
341     \textcolor{comment}{!beachWeight = 1 - 0.5*(sv%landIntMask - lbound)/(ubound-lbound) !linear distance weight for beaching}
342     beachweight = 1 - 0.9*(sv%landIntMask - lbound)/(ubound-lbound)*(sv%landIntMask - lbound)/(ubound-
      lbound) \textcolor{comment}{!quadratic weight}
343 
344     \textcolor{comment}{!replacing 1.0 with a coefficient from beaching where needed}
345     \textcolor{keywordflow}{where}(sv%landIntMask <= ubound .and. sv%landIntMask >= lbound) beachcoeff = beachcoeffrand*beachweight
346     \textcolor{keywordflow}{do} i=1,3
347         beaching(:,i) = svdt(:,i)*beachcoeff \textcolor{comment}{!position derivative is affected}
348         sv%state(:,i+3) = sv%state(:,i+3)*beachcoeff \textcolor{comment}{!so are the velocities}
349 \textcolor{keywordflow}{    end do}
350 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a43899c5dd3f82ed3dc4aade9aefd7a44}\label{namespacekernel__mod_a43899c5dd3f82ed3dc4aade9aefd7a44}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!degradationlinear@{degradationlinear}}
\index{degradationlinear@{degradationlinear}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{degradationlinear()}{degradationlinear()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::degradationlinear (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(in)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv }\end{DoxyParamCaption})}



Linear degradation kernel. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv} & \\
\hline
\end{DoxyParams}


Definition at line 490 of file kernel.\+f90.


\begin{DoxyCode}
490     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(in)} :: self
491     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
492     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: DegradationLinear
493     \textcolor{keywordtype}{integer} :: nf, idx
494     \textcolor{keywordtype}{type}(string) :: tag
495 
496     degradationlinear = 0.0
497     tag = \textcolor{stringliteral}{'condition'}
498     nf = utils%find\_str(sv%varName, tag, .true.)
499     tag = \textcolor{stringliteral}{'degradation\_rate'}
500     idx = utils%find\_str(sv%varName, tag, .true.)
501     
502     degradationlinear(:,nf) = -sv%state(:,idx)
503     \textcolor{keywordflow}{where}(sv%state(:,nf) < 0.0) sv%active = .false.
504 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a92805ef71e30527b27de4efd7561f8f7}\label{namespacekernel__mod_a92805ef71e30527b27de4efd7561f8f7}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!diffusionisotropic@{diffusionisotropic}}
\index{diffusionisotropic@{diffusionisotropic}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{diffusionisotropic()}{diffusionisotropic()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::diffusionisotropic (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(in)}]{sv,  }\item[{real(prec), intent(in)}]{dt }\end{DoxyParamCaption})}



Diffusion Kernel, computes the anisotropic diffusion assuming a constant diffusion coefficient. D = 1 m/s. 

\begin{DoxyAuthor}{Author}
Daniel Garaboa Paz -\/ U\+SC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,dt} & \\
\hline
\end{DoxyParams}


Definition at line 459 of file kernel.\+f90.


\begin{DoxyCode}
459     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
460     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(in)} :: sv
461     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: dt
462     \textcolor{keywordtype}{integer} :: np, i
463     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: rand\_vel\_u, rand\_vel\_v,rand\_vel\_w
464     \textcolor{keywordtype}{real(prec)} :: D = 1.
465     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: DiffusionIsotropic
466 
467     diffusionisotropic = 0.0
468     np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
469     \textcolor{keyword}{allocate}(rand\_vel\_u(np), rand\_vel\_v(np), rand\_vel\_w(np))
470     \textcolor{keyword}{call }random\_number(rand\_vel\_u)
471     \textcolor{keyword}{call }random\_number(rand\_vel\_v)
472     \textcolor{keyword}{call }random\_number(rand\_vel\_w)
473     \textcolor{comment}{!update velocities}
474     \textcolor{comment}{! For the moment we set D = 1 m/s, then the D parameter}
475     \textcolor{comment}{! should be part of the array of tracers parameter}
476     diffusionisotropic(:,1) = utils%m2geo((2.*rand\_vel\_u-1.)*sqrt(2.*d/dt), sv%state(:,2), .false.)
477     diffusionisotropic(:,2) = utils%m2geo((2.*rand\_vel\_v-1.)*sqrt(2.*d/dt), sv%state(:,2), .true.)
478     \textcolor{comment}{!DiffusionIsotropic(:,3) = (2.*rand\_vel\_w-1.)*sqrt(2.*D*0.0005/dt)}
479     \textcolor{keywordflow}{where} (sv%state(:,6) /= 0.0) diffusionisotropic(:,3) = (2.*rand\_vel\_w-1.)*sqrt(2.*d*0.0005/dt)
480 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a065d7965d3a572a524cfd6bdd4729898}\label{namespacekernel__mod_a065d7965d3a572a524cfd6bdd4729898}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!diffusionmixinglength@{diffusionmixinglength}}
\index{diffusionmixinglength@{diffusionmixinglength}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{diffusionmixinglength()}{diffusionmixinglength()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::diffusionmixinglength (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time,  }\item[{real(prec), intent(in)}]{dt }\end{DoxyParamCaption})}



mixing length diffusion kernel, computes random velocities at given instants to model diffusion processes. These are valid while the tracer travels a given mixing length, propotional to the resolution of the background (and its ability to resove motion scales) 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time,dt} & \\
\hline
\end{DoxyParams}


Definition at line 385 of file kernel.\+f90.


\begin{DoxyCode}
385     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
386     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
387     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
388     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time
389     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: dt
390     \textcolor{keywordtype}{integer} :: np, nf, bkg
391     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: var\_dt
392     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: var\_name
393     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: requiredVars
394     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: DiffusionMixingLength
395     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: resolution
396     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: rand\_vel\_u, rand\_vel\_v, rand\_vel\_w
397 
398     \textcolor{keyword}{allocate}(requiredvars(1))
399     requiredvars(1) = globals%Var%resolution
400 
401     diffusionmixinglength = 0.0
402     \textcolor{comment}{!interpolate each background}
403     \textcolor{keywordflow}{do} bkg = 1, \textcolor{keyword}{size}(bdata)
404         \textcolor{keywordflow}{if} (bdata(bkg)%initialized) \textcolor{keywordflow}{then}
405             \textcolor{keywordflow}{if}(self%hasRequiredVars(bdata(bkg)%variables, requiredvars)) \textcolor{keywordflow}{then}
406                 np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
407                 nf = bdata(bkg)%fields%getSize() \textcolor{comment}{!number of fields to interpolate}
408                 \textcolor{keyword}{allocate}(var\_dt(np,nf))
409                 \textcolor{keyword}{allocate}(var\_name(nf))
410 
411                 \textcolor{keyword}{allocate}(resolution(np))
412                 \textcolor{keyword}{allocate}(rand\_vel\_u(np), rand\_vel\_v(np), rand\_vel\_w(np))
413                 \textcolor{keyword}{call }random\_number(rand\_vel\_u)
414                 \textcolor{keyword}{call }random\_number(rand\_vel\_v)
415                 \textcolor{keyword}{call }random\_number(rand\_vel\_w)
416                 \textcolor{comment}{!interpolating all of the data}
417                 \textcolor{keyword}{call }self%Interpolator%run(sv%state, bdata(bkg), time, var\_dt, var\_name, requiredvars)
418                 \textcolor{comment}{!update resolution estimate}
419                 nf = utils%find\_str(var\_name, globals%Var%resolution, .true.)
420                 resolution = var\_dt(:,nf)
421                 \textcolor{comment}{!if we are still in the same path, use the same random velocity, do nothing}
422                 \textcolor{comment}{!if we ran the path, new random velocities are generated and placed}
423                 \textcolor{keywordflow}{where} (sv%state(:,10) > 2.0*resolution)
424                     diffusionmixinglength(:,7) = (2.*rand\_vel\_u-1.)*sqrt(globals%Constants%DiffusionCoeff*
      abs(sv%state(:,4))/dt)/dt
425                     diffusionmixinglength(:,8) = (2.*rand\_vel\_v-1.)*sqrt(globals%Constants%DiffusionCoeff*
      abs(sv%state(:,5))/dt)/dt
426                     diffusionmixinglength(:,9) = (2.*rand\_vel\_w-1.)*sqrt(0.000001*globals%Constants
      %DiffusionCoeff*abs(sv%state(:,6))/dt)/dt
427                     sv%state(:,10) = 0.0
428                     \textcolor{comment}{!update system positions}
429                     diffusionmixinglength(:,1) = utils%m2geo(diffusionmixinglength(:,7), sv%state(:,2), .
      false.)*dt
430                     diffusionmixinglength(:,2) = utils%m2geo(diffusionmixinglength(:,8), sv%state(:,2), .
      true.)*dt
431                     diffusionmixinglength(:,3) = diffusionmixinglength(:,9)*dt
432                 \textcolor{keywordflow}{elsewhere}
433                     \textcolor{comment}{!update system positions}
434                     diffusionmixinglength(:,1) = utils%m2geo(sv%state(:,7), sv%state(:,2), .false.)
435                     diffusionmixinglength(:,2) = utils%m2geo(sv%state(:,8), sv%state(:,2), .true.)
436                     diffusionmixinglength(:,3) = sv%state(:,9)
437 \textcolor{keywordflow}{                end where}
438                 \textcolor{comment}{!update system velocities}
439                 \textcolor{comment}{!sv%state(:,4) = sv%state(:,4) + DiffusionMixingLength(:,7)*dt}
440                 \textcolor{comment}{!sv%state(:,5) = sv%state(:,5) + DiffusionMixingLength(:,8)*dt}
441                 \textcolor{comment}{!sv%state(:,6) = sv%state(:,6) + DiffusionMixingLength(:,9)*dt                }
442                 \textcolor{comment}{!update used mixing length}
443                 diffusionmixinglength(:,10) = sqrt(sv%state(:,4)*sv%state(:,4) + sv%state(:,5)*sv%state(:,5
      ) + sv%state(:,6)*sv%state(:,6))
444                 \textcolor{keyword}{deallocate}(var\_dt)
445                 \textcolor{keyword}{deallocate}(var\_name)
446 \textcolor{keywordflow}{            end if}
447 \textcolor{keywordflow}{        end if}
448 \textcolor{keywordflow}{    end do}
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a4444d73e7295ba4b58add9b726de3135}\label{namespacekernel__mod_a4444d73e7295ba4b58add9b726de3135}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!hasrequiredvars@{hasrequiredvars}}
\index{hasrequiredvars@{hasrequiredvars}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{hasrequiredvars()}{hasrequiredvars()}}
{\footnotesize\ttfamily logical function kernel\+\_\+mod\+::hasrequiredvars (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(in)}]{self,  }\item[{type(stringlist\+\_\+class)}]{var\+List,  }\item[{type(string), dimension(\+:), intent(in)}]{req\+Vars }\end{DoxyParamCaption})}



returns true if a given set of strings (array) is contained in a list of strings 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,var\+List,req\+Vars} & \\
\hline
\end{DoxyParams}


Definition at line 514 of file kernel.\+f90.


\begin{DoxyCode}
514     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(in)} :: self
515     \textcolor{keywordtype}{type}(stringList\_class) :: varList
516     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: reqVars
517     \textcolor{keywordtype}{integer} :: i
518     hasrequiredvars = .true.
519     \textcolor{keywordflow}{do} i=1, \textcolor{keyword}{size}(reqvars)
520         \textcolor{keywordflow}{if} (varlist%notRepeated(reqvars(i))) \textcolor{keywordflow}{then}
521             hasrequiredvars = .false.
522             \textcolor{keywordflow}{return}
523 \textcolor{keywordflow}{        end if}
524 \textcolor{keywordflow}{    end do}
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a26c62a8eec723402e20142e68ba7ec65}\label{namespacekernel__mod_a26c62a8eec723402e20142e68ba7ec65}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!initkernel@{initkernel}}
\index{initkernel@{initkernel}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{initkernel()}{initkernel()}}
{\footnotesize\ttfamily subroutine kernel\+\_\+mod\+::initkernel (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})}



Initializer method adpated from for solver kernel class. Sets the type of kernel and the interpolator to evaluate it. 

\begin{DoxyAuthor}{Author}
Daniel Garaboa Paz -\/ G\+F\+NL 
\end{DoxyAuthor}


Definition at line 534 of file kernel.\+f90.


\begin{DoxyCode}
534     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
535     \textcolor{keywordtype}{type}(string) :: interpName
536     interpname = \textcolor{stringliteral}{'linear'}
537     \textcolor{keyword}{call }self%Interpolator%initialize(1,interpname)
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a7a181eab538ac32b3bddcf4bb34503bd}\label{namespacekernel__mod_a7a181eab538ac32b3bddcf4bb34503bd}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!lagrangiankinematic@{lagrangiankinematic}}
\index{lagrangiankinematic@{lagrangiankinematic}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{lagrangiankinematic()}{lagrangiankinematic()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::lagrangiankinematic (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time }\end{DoxyParamCaption})}



Lagrangian Kernel, evaluate the velocities at given points using the interpolants and split the evaluation part from the solver module. 

\begin{DoxyAuthor}{Author}
Daniel Garaboa Paz -\/ U\+SC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time} & \\
\hline
\end{DoxyParams}


Definition at line 151 of file kernel.\+f90.


\begin{DoxyCode}
151     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
152     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
153     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
154     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time
155     \textcolor{keywordtype}{integer} :: np, nf, bkg, i
156     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: var\_dt
157     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: var\_name
158     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: requiredVars
159     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: LagrangianKinematic
160 
161     \textcolor{keyword}{allocate}(requiredvars(2))
162     requiredvars(1) = globals%Var%u
163     requiredvars(2) = globals%Var%v
164 
165     lagrangiankinematic = 0.0
166     \textcolor{comment}{!interpolate each background}
167     \textcolor{keywordflow}{do} bkg = 1, \textcolor{keyword}{size}(bdata)
168         \textcolor{keywordflow}{if} (bdata(bkg)%initialized) \textcolor{keywordflow}{then}
169             \textcolor{keywordflow}{if}(self%hasRequiredVars(bdata(bkg)%variables, requiredvars)) \textcolor{keywordflow}{then}
170                 np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
171                 nf = bdata(bkg)%fields%getSize() \textcolor{comment}{!number of fields to interpolate}
172                 \textcolor{keyword}{allocate}(var\_dt(np,nf))
173                 \textcolor{keyword}{allocate}(var\_name(nf))
174 
175                 \textcolor{comment}{!interpolating all of the data}
176                 \textcolor{keyword}{call }self%Interpolator%run(sv%state, bdata(bkg), time, var\_dt, var\_name)
177 
178                 \textcolor{comment}{!write dx/dt}
179                 nf = utils%find\_str(var\_name, globals%Var%u, .true.)
180                 lagrangiankinematic(:,1) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .false.)
181                 sv%state(:,4) = var\_dt(:,nf)
182                 nf = utils%find\_str(var\_name, globals%Var%v, .true.)
183                 lagrangiankinematic(:,2) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .true.)
184                 sv%state(:,5) = var\_dt(:,nf)
185                 nf = utils%find\_str(var\_name, globals%Var%w, .false.)
186                 \textcolor{keywordflow}{if} (nf /= mv\_int) \textcolor{keywordflow}{then}
187                     lagrangiankinematic(:,3) = var\_dt(:,nf)
188                     sv%state(:,6) = var\_dt(:,nf)
189                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nf == mv\_int) \textcolor{keywordflow}{then}
190                     lagrangiankinematic(:,3) = 0.0
191                     sv%state(:,6) = 0.0
192 \textcolor{keywordflow}{                end if}
193 
194                 \textcolor{keyword}{deallocate}(var\_dt)
195                 \textcolor{keyword}{deallocate}(var\_name)
196 \textcolor{keywordflow}{            end if}
197 \textcolor{keywordflow}{        end if}
198 \textcolor{keywordflow}{    end do}
199 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_ae17673ed6d32a4e7f6e54276e6430cc9}\label{namespacekernel__mod_ae17673ed6d32a4e7f6e54276e6430cc9}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!runkernel@{runkernel}}
\index{runkernel@{runkernel}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{runkernel()}{runkernel()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::runkernel (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time,  }\item[{real(prec), intent(in)}]{dt }\end{DoxyParamCaption})}



Adaptation from run\+Solver (Ricardo) method that evaluates the specific kernel, according to the selected kernel. 

\begin{DoxyAuthor}{Author}
Daniel Garaboa Paz -\/ G\+F\+NL 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time,dt} & \\
\hline
\end{DoxyParams}


Definition at line 60 of file kernel.\+f90.


\begin{DoxyCode}
60     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
61     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
62     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
63     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time, dt
64     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: runKernel
65 
66     \textcolor{comment}{!running preparations for kernel lanch}
67     \textcolor{keyword}{call }self%setCommonProcesses(sv, bdata, time)
68 
69     \textcolor{comment}{!running kernels for each type of tracer}
70     \textcolor{keywordflow}{if} (sv%ttype == globals%Types%base) \textcolor{keywordflow}{then}
71         runkernel = self%LagrangianKinematic(sv, bdata, time) + self%StokesDrift(sv, bdata, time) + self
      %Windage(sv, bdata, time) + self%DiffusionMixingLength(sv, bdata, time, dt) + self%Aging(sv)
72         runkernel = self%Beaching(sv, runkernel)
73     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sv%ttype == globals%Types%paper) \textcolor{keywordflow}{then}
74         runkernel = self%LagrangianKinematic(sv, bdata, time) + self%StokesDrift(sv, bdata, time) + self
      %Windage(sv, bdata, time) + self%DiffusionMixingLength(sv, bdata, time, dt) + self%Aging(sv) + self
      %DegradationLinear(sv)
75         runkernel = self%Beaching(sv, runkernel)
76     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sv%ttype == globals%Types%plastic) \textcolor{keywordflow}{then}
77         runkernel = self%LagrangianKinematic(sv, bdata, time) + self%StokesDrift(sv, bdata, time) + self
      %Windage(sv, bdata, time) + self%DiffusionMixingLength(sv, bdata, time, dt) + self%Aging(sv) + self
      %DegradationLinear(sv)
78         runkernel = self%Beaching(sv, runkernel)
79 \textcolor{keywordflow}{    end if}
80 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a1032cd0a40cff8301fcf2ca880c81039}\label{namespacekernel__mod_a1032cd0a40cff8301fcf2ca880c81039}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!setcommonprocesses@{setcommonprocesses}}
\index{setcommonprocesses@{setcommonprocesses}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{setcommonprocesses()}{setcommonprocesses()}}
{\footnotesize\ttfamily subroutine kernel\+\_\+mod\+::setcommonprocesses (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(inout)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time }\end{DoxyParamCaption})}



Sets the state vector land interaction mask values and corrects for maximum level of tracers. Accounts for global periodicity. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time} & \\
\hline
\end{DoxyParams}


Definition at line 92 of file kernel.\+f90.


\begin{DoxyCode}
92     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
93     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(inout)} :: sv
94     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
95     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time
96     \textcolor{keywordtype}{integer} :: np, nf, bkg
97     \textcolor{keywordtype}{real(prec)} :: maxLevel(2)
98     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: var\_dt
99     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: var\_name
100     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: requiredVars
101 
102     \textcolor{keyword}{allocate}(requiredvars(2))
103     requiredvars(1) = globals%Var%landIntMask
104     requiredvars(2) = globals%Var%resolution
105         
106     \textcolor{comment}{! global periodicity conditions}
107     \textcolor{keywordflow}{where} (sv%state(:,1) > 180.0) sv%state(:,1) = sv%state(:,1) - 360.0
108     \textcolor{keywordflow}{where} (sv%state(:,1) < -180.0) sv%state(:,1) = sv%state(:,1) + 360.0
109 
110     \textcolor{comment}{!interpolate each background}
111     \textcolor{keywordflow}{do} bkg = 1, \textcolor{keyword}{size}(bdata)
112         \textcolor{keywordflow}{if} (bdata(bkg)%initialized) \textcolor{keywordflow}{then}
113             \textcolor{keywordflow}{if}(self%hasRequiredVars(bdata(bkg)%variables, requiredvars)) \textcolor{keywordflow}{then}
114                 np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
115                 nf = bdata(bkg)%fields%getSize() \textcolor{comment}{!number of fields to interpolate}
116                 \textcolor{keyword}{allocate}(var\_dt(np,nf))
117                 \textcolor{keyword}{allocate}(var\_name(nf))
118 
119                 \textcolor{comment}{!correcting for maximum admissible level in the background}
120                 maxlevel = bdata(bkg)%getDimExtents(globals%Var%level, .false.)
121                 \textcolor{keywordflow}{if} (maxlevel(2) /= mv) \textcolor{keywordflow}{where} (sv%state(:,3) > maxlevel(2)) sv%state(:,3) = maxlevel(2)-0.00
      001
122 
123                 \textcolor{comment}{!interpolating all of the data}
124                 \textcolor{keyword}{call }self%Interpolator%run(sv%state, bdata(bkg), time, var\_dt, var\_name, requiredvars)
125 
126                 \textcolor{comment}{!update land interaction status}
127                 nf = utils%find\_str(var\_name, globals%Var%landIntMask)
128                 sv%landIntMask = var\_dt(:,nf)
129                 \textcolor{comment}{!marking tracers for deletion because they are in land}
130                 \textcolor{keywordflow}{where}(int(sv%landIntMask + globals%Mask%landVal*0.05) == globals%Mask%landVal) sv%active = 
      .false.
131                 \textcolor{comment}{!update resolution proxy}
132                 nf = utils%find\_str(var\_name, globals%Var%resolution)
133                 sv%resolution = var\_dt(:,nf)
134 
135                 \textcolor{keyword}{deallocate}(var\_dt)
136                 \textcolor{keyword}{deallocate}(var\_name)
137 \textcolor{keywordflow}{            end if}
138 \textcolor{keywordflow}{        end if}
139 \textcolor{keywordflow}{    end do}
140 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_a69811135e6a881c537873c59451f689e}\label{namespacekernel__mod_a69811135e6a881c537873c59451f689e}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!stokesdrift@{stokesdrift}}
\index{stokesdrift@{stokesdrift}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{stokesdrift()}{stokesdrift()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::stokesdrift (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(in)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time }\end{DoxyParamCaption})}



Computes the influence of wave velocity in tracer kinematics. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time} & \\
\hline
\end{DoxyParams}


Definition at line 209 of file kernel.\+f90.


\begin{DoxyCode}
209     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
210     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(in)} :: sv
211     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
212     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time
213     \textcolor{keywordtype}{integer} :: np, nf, bkg
214     \textcolor{keywordtype}{real(prec)} :: waveCoeff
215     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: var\_dt
216     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: var\_name
217     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: requiredVars
218     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: StokesDrift
219     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1))} :: depth
220 
221     \textcolor{keyword}{allocate}(requiredvars(2))
222     requiredvars(1) = globals%Var%vsdx
223     requiredvars(2) = globals%Var%vsdy
224 
225     wavecoeff = 0.01
226     stokesdrift = 0.0
227     \textcolor{comment}{!interpolate each background}
228     \textcolor{keywordflow}{do} bkg = 1, \textcolor{keyword}{size}(bdata)
229         \textcolor{keywordflow}{if} (bdata(bkg)%initialized) \textcolor{keywordflow}{then}
230             \textcolor{keywordflow}{if}(self%hasRequiredVars(bdata(bkg)%variables, requiredvars)) \textcolor{keywordflow}{then}
231                 np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
232                 nf = bdata(bkg)%fields%getSize() \textcolor{comment}{!number of fields to interpolate}
233                 \textcolor{keyword}{allocate}(var\_dt(np,nf))
234                 \textcolor{keyword}{allocate}(var\_name(nf))
235                 \textcolor{comment}{!interpolating all of the data}
236                 \textcolor{keyword}{call }self%Interpolator%run(sv%state, bdata(bkg), time, var\_dt, var\_name)
237                 \textcolor{comment}{!computing the depth weight}
238                 depth = sv%state(:,3)
239                 \textcolor{keywordflow}{where} (depth>=0.0) depth = 0.0
240                 depth = exp(depth)
241                 \textcolor{comment}{!write dx/dt}
242                 nf = utils%find\_str(var\_name, globals%Var%vsdx, .true.)
243                 stokesdrift(:,1) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .false.)*wavecoeff*depth
244                 nf = utils%find\_str(var\_name, globals%Var%vsdy, .true.)
245                 stokesdrift(:,2) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .true.)*wavecoeff*depth
246                 \textcolor{keyword}{deallocate}(var\_dt)
247                 \textcolor{keyword}{deallocate}(var\_name)
248 \textcolor{keywordflow}{            end if}
249 \textcolor{keywordflow}{        end if}
250 \textcolor{keywordflow}{    end do}
251 
\end{DoxyCode}
\mbox{\Hypertarget{namespacekernel__mod_ae9cf0f11335d49476ce48a37c2fbde83}\label{namespacekernel__mod_ae9cf0f11335d49476ce48a37c2fbde83}} 
\index{kernel\+\_\+mod@{kernel\+\_\+mod}!windage@{windage}}
\index{windage@{windage}!kernel\+\_\+mod@{kernel\+\_\+mod}}
\subsubsection{\texorpdfstring{windage()}{windage()}}
{\footnotesize\ttfamily real(prec) function, dimension(size(sv\%state,1),size(sv\%state,2)) kernel\+\_\+mod\+::windage (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structkernel__mod_1_1kernel__class}{kernel\+\_\+class}}), intent(inout)}]{self,  }\item[{type(statevector\+\_\+class), intent(in)}]{sv,  }\item[{type(\mbox{\hyperlink{structbackground__mod_1_1background__class}{background\+\_\+class}}), dimension(\+:), intent(in)}]{bdata,  }\item[{real(prec), intent(in)}]{time }\end{DoxyParamCaption})}



Computes the influence of wind velocity in tracer kinematics. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sv,bdata,time} & \\
\hline
\end{DoxyParams}


Definition at line 261 of file kernel.\+f90.


\begin{DoxyCode}
261     \textcolor{keywordtype}{class}(kernel\_class), \textcolor{keywordtype}{intent(inout)} :: self
262     \textcolor{keywordtype}{type}(stateVector\_class), \textcolor{keywordtype}{intent(in)} :: sv
263     \textcolor{keywordtype}{type}(background\_class), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: bdata
264     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{intent(in)} :: time
265     \textcolor{keywordtype}{integer} :: np, nf, bkg
266     \textcolor{keywordtype}{real(prec)} :: windCoeff
267     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} :: var\_dt
268     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: var\_name
269     \textcolor{keywordtype}{type}(string), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: requiredVars
270     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1),size(sv%state,2))} :: Windage
271     \textcolor{keywordtype}{real(prec)}, \textcolor{keywordtype}{dimension(size(sv%state,1))} :: depth
272 
273     \textcolor{keyword}{allocate}(requiredvars(2))
274     requiredvars(1) = globals%Var%u10
275     requiredvars(2) = globals%Var%v10
276 
277     windcoeff = 0.03
278     windage = 0.0
279     \textcolor{comment}{!interpolate each background}
280     \textcolor{keywordflow}{do} bkg = 1, \textcolor{keyword}{size}(bdata)
281         \textcolor{keywordflow}{if} (bdata(bkg)%initialized) \textcolor{keywordflow}{then}
282             \textcolor{keywordflow}{if}(self%hasRequiredVars(bdata(bkg)%variables, requiredvars)) \textcolor{keywordflow}{then}
283                 np = \textcolor{keyword}{size}(sv%active) \textcolor{comment}{!number of Tracers}
284                 nf = bdata(bkg)%fields%getSize() \textcolor{comment}{!number of fields to interpolate}
285                 \textcolor{keyword}{allocate}(var\_dt(np,nf))
286                 \textcolor{keyword}{allocate}(var\_name(nf))
287                 \textcolor{comment}{!interpolating all of the data}
288                 \textcolor{keyword}{call }self%Interpolator%run(sv%state, bdata(bkg), time, var\_dt, var\_name)
289                 \textcolor{comment}{!computing the depth weight}
290                 depth = sv%state(:,3)
291                 \textcolor{keywordflow}{where} (depth>=0.0) depth = 0.0
292                 \textcolor{comment}{!where (depth == 0.0) }
293                 \textcolor{comment}{!    nf = Utils%find\_str(var\_name, Globals%Var%u10, .true.)}
294                 \textcolor{comment}{!    Windage(:,1) = Utils%m2geo(var\_dt(:,nf), sv%state(:,2), .false.)*windCoeff*depth}
295                 \textcolor{comment}{!    nf = Utils%find\_str(var\_name, Globals%Var%v10, .true.)}
296                 \textcolor{comment}{!    Windage(:,2) = Utils%m2geo(var\_dt(:,nf), sv%state(:,2), .true.)*windCoeff*depth}
297                 \textcolor{comment}{!end where}
298                 depth = exp(10.0*depth)
299                 \textcolor{comment}{!write dx/dt}
300                 nf = utils%find\_str(var\_name, globals%Var%u10, .true.)
301                 windage(:,1) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .false.)*windcoeff*depth
302                 nf = utils%find\_str(var\_name, globals%Var%v10, .true.)
303                 windage(:,2) = utils%m2geo(var\_dt(:,nf), sv%state(:,2), .true.)*windcoeff*depth
304                 \textcolor{keyword}{deallocate}(var\_dt)
305                 \textcolor{keyword}{deallocate}(var\_name)
306 \textcolor{keywordflow}{            end if}
307 \textcolor{keywordflow}{        end if}
308 \textcolor{keywordflow}{    end do}
309 
\end{DoxyCode}
