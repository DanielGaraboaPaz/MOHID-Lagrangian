\hypertarget{namespaceblocks__mod}{}\section{blocks\+\_\+mod Module Reference}
\label{namespaceblocks__mod}\index{blocks\+\_\+mod@{blocks\+\_\+mod}}


Module that defines a block class and related methods. A block is a fundamental type of the model. It contains a sub-\/domain of the simulation bounding box, holding all entities inside that sub-\/domain. It maps to a domain decomposition parallelization strategy, if needed.  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}
\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function \mbox{\hyperlink{namespaceblocks__mod_a7202fad0fdc07ff9111e61e3aa513af9}{numalloctracers}} (self)
\begin{DoxyCompactList}\small\item\em method that returns the total allocated Tracers in the Block \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a534ca69b17b6f54ee07f995b02feff39}{initblock}} (self, id, templatebox)
\begin{DoxyCompactList}\small\item\em method to allocate and initialize Blocks and their Emitters \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_ae3bd1bfeee831f4b41932839495bb108}{putsource}} (self, sourcetoadd)
\begin{DoxyCompactList}\small\item\em Method to place a Source on the Block source\+List\+\_\+class object. Adds the Source info to the Block Emitter. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_ab9e57cbf0103b632b2b2dfa4e4d4139c}{toogleblocksources}} (self)
\begin{DoxyCompactList}\small\item\em Method to activate and deactivate the sources on this block, based on GlobalsSim\+TimeCurr\+Time. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a2c3cf5113e1422d812c2c869afde2729}{callemitter}} (self)
\begin{DoxyCompactList}\small\item\em Method to emitt Tracers from currently active Sources on the Block. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_aa178415bcc40cf169744d356e1a09c6b}{distributetracers}} (self)
\begin{DoxyCompactList}\small\item\em Method to distribute the Tracers to their correct Blocks. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a25ff530b5125e4cee5b1f474b2491883}{consolidatearrays}} (self)
\begin{DoxyCompactList}\small\item\em Method to clean the Tracer list from inactive Tracers. This includes tracers that escaped from the Simulation Bounding Box. Also builds the counter of types and tracers per type. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a04a9fab577b0d1fb6cabefcde2b2180d}{shedmemory}} (self)
\begin{DoxyCompactList}\small\item\em Method that calls background functions to clean data no longer needed. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_aa9c438503e619aa4352081ff46b15430}{tracerstosv}} (self)
\begin{DoxyCompactList}\small\item\em Method to build the State Vector at this timestep for actual numerical work. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a3245bdadbec6bb123c517921d1503b48}{runsolver}} (self)
\begin{DoxyCompactList}\small\item\em Method to run the solver on the data on this Block for the current timestep. Time for some actual numerical work! \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a306a753acc9b8bb9107ebda481162180}{svtotracers}} (self)
\begin{DoxyCompactList}\small\item\em Method to write the data in the SV back to the Tracer objects in the list. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_ab70bfe5cdce5a717115cfbac04f606a0}{cleansv}} (self)
\begin{DoxyCompactList}\small\item\em Method to clean out the State Vector object. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a5a9992de40470e417ec8e40e688f6a0e}{sendtracer}} (blk, trc)
\begin{DoxyCompactList}\small\item\em Method to send a Tracer from the current Block to another Block. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a1e632738786730731a48d9a432f6ab84}{sendsource}} (blk, src)
\begin{DoxyCompactList}\small\item\em Method to send a Source from the current Block to another Block. \end{DoxyCompactList}\item 
integer function, public \mbox{\hyperlink{namespaceblocks__mod_a62e8fb0d6b2535b4499c7a4d848c24ba}{getblockindex}} (pt)
\begin{DoxyCompactList}\small\item\em Returns the index of a Block for a given set of coordinates. \end{DoxyCompactList}\item 
logical function \mbox{\hyperlink{namespaceblocks__mod_a101d0a23b5b56baf6e5bd35bc7b677b0}{trcinbbox}} (trc, testbox)
\begin{DoxyCompactList}\small\item\em Returns true if the point is inside the requested bounding box. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a6eab8b323cb15dcecb5c6b0c31b4e246}{printblock}} (self)
\begin{DoxyCompactList}\small\item\em Method to print basic info about the block. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceblocks__mod_a10f356706988c45a255922fe70851488}{printdetailblock}} (self)
\begin{DoxyCompactList}\small\item\em Method to print detailed info about the block. \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespaceblocks__mod_a8f5a5d9e6cfd16cfd1b179092a204696}{setblocks}} (auto, nblk, nxi, nyi)
\begin{DoxyCompactList}\small\item\em routine to set the simulation blocks extents and call the block initializer \end{DoxyCompactList}\item 
subroutine, public \mbox{\hyperlink{namespaceblocks__mod_a639beb0fee2290d46353f4b4702d6711}{allocblocks}} (nblk)
\begin{DoxyCompactList}\small\item\em routine to allocate the simulation blocks \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
type(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), allocatable, public \mbox{\hyperlink{namespaceblocks__mod_a13b3fc755dfbf3e333490a3f931b28aa}{sblock}}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Module that defines a block class and related methods. A block is a fundamental type of the model. It contains a sub-\/domain of the simulation bounding box, holding all entities inside that sub-\/domain. It maps to a domain decomposition parallelization strategy, if needed. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas 
\end{DoxyAuthor}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespaceblocks__mod_a639beb0fee2290d46353f4b4702d6711}\label{namespaceblocks__mod_a639beb0fee2290d46353f4b4702d6711}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!allocblocks@{allocblocks}}
\index{allocblocks@{allocblocks}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{allocblocks()}{allocblocks()}}
{\footnotesize\ttfamily subroutine, public blocks\+\_\+mod\+::allocblocks (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{nblk }\end{DoxyParamCaption})}



routine to allocate the simulation blocks 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nblk} & \\
\hline
\end{DoxyParams}


Definition at line 615 of file blocks.\+f90.


\begin{DoxyCode}
615     \textcolor{keywordtype}{implicit none}
616     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} ::  nblk
617     \textcolor{keywordtype}{type}(string) :: outext, temp
618     \textcolor{keywordtype}{integer} err
619     \textcolor{keyword}{allocate}(sblock(nblk), stat=err)
620     \textcolor{keywordflow}{if}(err/=0)\textcolor{keywordflow}{then}
621         outext=\textcolor{stringliteral}{'[allocBlobks]: Cannot allocate Blocks, stoping'}
622         \textcolor{keyword}{call }log%put(outext)
623         stop
624     \textcolor{keywordflow}{else}
625         temp = nblk
626         outext = \textcolor{stringliteral}{'Allocated '}// temp // \textcolor{stringliteral}{' Blocks.'}
627         \textcolor{keyword}{call }log%put(outext)
628 \textcolor{keywordflow}{    endif}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a639beb0fee2290d46353f4b4702d6711_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a2c3cf5113e1422d812c2c869afde2729}\label{namespaceblocks__mod_a2c3cf5113e1422d812c2c869afde2729}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!callemitter@{callemitter}}
\index{callemitter@{callemitter}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{callemitter()}{callemitter()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::callemitter (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to emitt Tracers from currently active Sources on the Block. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 187 of file blocks.\+f90.


\begin{DoxyCode}
187     \textcolor{keywordtype}{implicit none}
188     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
189     \textcolor{keyword}{call }self%Emitter%emitt(self%LSource, self%LTracer)
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_ab70bfe5cdce5a717115cfbac04f606a0}\label{namespaceblocks__mod_ab70bfe5cdce5a717115cfbac04f606a0}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!cleansv@{cleansv}}
\index{cleansv@{cleansv}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{cleansv()}{cleansv()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::cleansv (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to clean out the State Vector object. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 430 of file blocks.\+f90.


\begin{DoxyCode}
430     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
431     \textcolor{keywordtype}{integer} :: i
432     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%BlockState)) \textcolor{keywordflow}{then}
433         \textcolor{keywordflow}{do} i=1, \textcolor{keyword}{size}(self%BlockState)
434             \textcolor{keyword}{call }self%BlockState(i)%finalize()
435 \textcolor{keywordflow}{        end do}
436         \textcolor{keyword}{deallocate}(self%BlockState)
437 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a25ff530b5125e4cee5b1f474b2491883}\label{namespaceblocks__mod_a25ff530b5125e4cee5b1f474b2491883}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!consolidatearrays@{consolidatearrays}}
\index{consolidatearrays@{consolidatearrays}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{consolidatearrays()}{consolidatearrays()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::consolidatearrays (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to clean the Tracer list from inactive Tracers. This includes tracers that escaped from the Simulation Bounding Box. Also builds the counter of types and tracers per type. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 239 of file blocks.\+f90.


\begin{DoxyCode}
239     \textcolor{keywordtype}{implicit none}
240     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
241     \textcolor{keywordtype}{class}(*), \textcolor{keywordtype}{pointer} :: aTracer
242     \textcolor{keywordtype}{type}(string) :: outext
243     \textcolor{keywordtype}{logical} :: notremoved
244    
245     \textcolor{keyword}{call }self%LTracer%reset()                   \textcolor{comment}{! reset list iterator}
246     \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(self%LTracer%moreValues())         \textcolor{comment}{! loop while there are values}
247         notremoved = .true.
248         atracer => self%LTracer%currentValue()  \textcolor{comment}{! get current value}
249         \textcolor{keywordflow}{select type}(atracer)
250 \textcolor{keywordflow}{        class is} (tracer\_class)
251             \textcolor{keywordflow}{if} (atracer%now%active) atracer%now%active = trcinbbox(atracer%now%pos, bbox) \textcolor{comment}{!check that the
       Tracer is inside the Simulation domain}
252             \textcolor{keywordflow}{if} (atracer%now%active .eqv. .false.) \textcolor{keywordflow}{then}
253                 \textcolor{keyword}{call }self%LTracer%removeCurrent() \textcolor{comment}{!this advances the iterator to the next position}
254                 notremoved = .false.            
255 \textcolor{keywordflow}{            end if}
256 \textcolor{keywordflow}{            class default}
257             outext = \textcolor{stringliteral}{'[Block::ConsolidateArrays]: Unexepected type of content, not a Tracer'}
258             \textcolor{keyword}{call }log%put(outext)
259             stop
260 \textcolor{keywordflow}{        end select}
261         \textcolor{keywordflow}{if} (notremoved) \textcolor{keyword}{call }self%LTracer%next()    \textcolor{comment}{! increment the list iterator}
262 \textcolor{keywordflow}{    end do}
263     \textcolor{keyword}{call }self%LTracer%reset()                       \textcolor{comment}{! reset list iterator}
264 
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a25ff530b5125e4cee5b1f474b2491883_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_aa178415bcc40cf169744d356e1a09c6b}\label{namespaceblocks__mod_aa178415bcc40cf169744d356e1a09c6b}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!distributetracers@{distributetracers}}
\index{distributetracers@{distributetracers}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{distributetracers()}{distributetracers()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::distributetracers (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to distribute the Tracers to their correct Blocks. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 198 of file blocks.\+f90.


\begin{DoxyCode}
198     \textcolor{keywordtype}{implicit none}
199     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
200     \textcolor{keywordtype}{integer} :: i, blk
201     \textcolor{keywordtype}{class}(*), \textcolor{keywordtype}{pointer} :: aTracer
202     \textcolor{keywordtype}{type}(string) :: outext
203     \textcolor{keywordtype}{logical} :: notremoved
204 
205     \textcolor{keyword}{call }self%LTracer%reset()                   \textcolor{comment}{! reset list iterator}
206     \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(self%LTracer%moreValues())         \textcolor{comment}{! loop while there are values}
207         notremoved = .true.
208         atracer => self%LTracer%currentValue()  \textcolor{comment}{! get current value}
209         \textcolor{keywordflow}{select type}(atracer)
210 \textcolor{keywordflow}{        class is} (tracer\_class)
211             \textcolor{keywordflow}{if} (atracer%now%active) \textcolor{keywordflow}{then}
212                 blk = getblockindex(atracer%now%pos)
213                 \textcolor{keywordflow}{if} (blk /= self%id) \textcolor{keywordflow}{then}        \textcolor{comment}{!tracer is on a different block than the current one}
214                     \textcolor{comment}{!PARALLEL this is a CRITICAL section, need to ensure correct tracer index attribution}
215                     \textcolor{keyword}{call }sendtracer(blk,atracer)
216                     \textcolor{keyword}{call }self%LTracer%removeCurrent() \textcolor{comment}{!this also advances the iterator to the next position}
217                     notremoved = .false.
218 \textcolor{keywordflow}{                end if}
219 \textcolor{keywordflow}{            end if}
220 \textcolor{keywordflow}{            class default}
221             outext = \textcolor{stringliteral}{'[Block::DistributeTracers]: Unexepected type of content, not a Tracer'}
222             \textcolor{keyword}{call }log%put(outext)
223             stop
224 \textcolor{keywordflow}{        end select}
225         \textcolor{keywordflow}{if} (notremoved) \textcolor{keyword}{call }self%LTracer%next()    \textcolor{comment}{! increment the list iterator}
226 \textcolor{keywordflow}{    end do}
227     \textcolor{keyword}{call }self%LTracer%reset()                   \textcolor{comment}{! reset list iterator}
228 
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_aa178415bcc40cf169744d356e1a09c6b_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a62e8fb0d6b2535b4499c7a4d848c24ba}\label{namespaceblocks__mod_a62e8fb0d6b2535b4499c7a4d848c24ba}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!getblockindex@{getblockindex}}
\index{getblockindex@{getblockindex}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{getblockindex()}{getblockindex()}}
{\footnotesize\ttfamily integer function, public blocks\+\_\+mod\+::getblockindex (\begin{DoxyParamCaption}\item[{type(vector), intent(in)}]{pt }\end{DoxyParamCaption})}



Returns the index of a Block for a given set of coordinates. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pt} & \\
\hline
\end{DoxyParams}


Definition at line 475 of file blocks.\+f90.


\begin{DoxyCode}
475     \textcolor{keywordtype}{implicit none}
476     \textcolor{keywordtype}{type}(vector), \textcolor{keywordtype}{intent(in)} :: pt
477     \textcolor{keywordtype}{integer} :: ix, iy
478     \textcolor{keywordtype}{type}(string) :: outext
479     ix = min(int((pt%x + bbox%offset%x)/globals%SimDefs%blocksize%x) + 1, globals%SimDefs%numblocksx)
480     iy = min(int((pt%y + bbox%offset%y)/globals%SimDefs%blocksize%y) + 1, globals%SimDefs%numblocksy)
481     getblockindex = globals%SimDefs%numblocksy*(ix-1) + iy
482     \textcolor{keywordflow}{if} (getblockindex < 0) \textcolor{keywordflow}{then}
483         \textcolor{keywordflow}{if} (getblockindex > globals%SimDefs%numblocks) \textcolor{keywordflow}{then}
484             outext=\textcolor{stringliteral}{'[getBlockIndex]: point coordinates out of simulation bound, stoping'}
485             \textcolor{keyword}{call }log%put(outext)
486             stop
487 \textcolor{keywordflow}{        end if}
488 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a62e8fb0d6b2535b4499c7a4d848c24ba_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a534ca69b17b6f54ee07f995b02feff39}\label{namespaceblocks__mod_a534ca69b17b6f54ee07f995b02feff39}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!initblock@{initblock}}
\index{initblock@{initblock}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{initblock()}{initblock()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::initblock (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self,  }\item[{integer, intent(in)}]{id,  }\item[{type(\mbox{\hyperlink{structgeometry__mod_1_1box}{box}}), intent(in)}]{templatebox }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



method to allocate and initialize Blocks and their Emitters 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,id,templatebox} & \\
\hline
\end{DoxyParams}


Definition at line 98 of file blocks.\+f90.


\begin{DoxyCode}
98     \textcolor{keywordtype}{implicit none}
99     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
100     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: id
101     \textcolor{keywordtype}{type}(box), \textcolor{keywordtype}{intent(in)} :: templatebox
102     \textcolor{keywordtype}{integer} :: sizem, i
103     self%id = id
104     \textcolor{comment}{!setting the block sub-domain}
105     self%extents = templatebox
106     \textcolor{comment}{!initializing the block emitter}
107     \textcolor{keyword}{call }self%Emitter%initialize()
108     \textcolor{comment}{!initializing the block solver}
109     i = globals%Parameters%Integrator
110     \textcolor{keyword}{call }self%Solver%initialize(i, globals%Parameters%IntegratorNames(i))
111     sizem = sizeof(self)
112     \textcolor{keyword}{call }simmemory%addblock(sizem)
113 
114     \textcolor{comment}{!Tests}
115     \textcolor{comment}{!allocate(self%Background(1))}
116     \textcolor{comment}{!call TestMaker%initialize(3, self%extents, self%Background(1))}
117 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a7202fad0fdc07ff9111e61e3aa513af9}\label{namespaceblocks__mod_a7202fad0fdc07ff9111e61e3aa513af9}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!numalloctracers@{numalloctracers}}
\index{numalloctracers@{numalloctracers}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{numalloctracers()}{numalloctracers()}}
{\footnotesize\ttfamily integer function blocks\+\_\+mod\+::numalloctracers (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(in)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



method that returns the total allocated Tracers in the Block 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 85 of file blocks.\+f90.


\begin{DoxyCode}
85     \textcolor{keywordtype}{implicit none}
86     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(in)} :: self
87     \textcolor{keywordtype}{integer} :: numAllocTracers
88     numalloctracers = self%LTracer%getSize()
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a6eab8b323cb15dcecb5c6b0c31b4e246}\label{namespaceblocks__mod_a6eab8b323cb15dcecb5c6b0c31b4e246}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!printblock@{printblock}}
\index{printblock@{printblock}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{printblock()}{printblock()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::printblock (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to print basic info about the block. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 524 of file blocks.\+f90.


\begin{DoxyCode}
524     \textcolor{keywordtype}{implicit none}
525     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
526     \textcolor{keywordtype}{type}(string) :: outext, temp\_str
527     temp\_str = self%id
528     outext=\textcolor{stringliteral}{'-->Block '}//temp\_str//\textcolor{stringliteral}{' is a'}
529     \textcolor{keyword}{call }log%put(outext,.false.)
530     \textcolor{keyword}{call }geometry%print(self%extents)
531     temp\_str = self%LSource%getSize()
532     outext=\textcolor{stringliteral}{'      and has '}//temp\_str//\textcolor{stringliteral}{' Sources'}
533     \textcolor{keyword}{call }log%put(outext,.false.)
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a10f356706988c45a255922fe70851488}\label{namespaceblocks__mod_a10f356706988c45a255922fe70851488}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!printdetailblock@{printdetailblock}}
\index{printdetailblock@{printdetailblock}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{printdetailblock()}{printdetailblock()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::printdetailblock (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to print detailed info about the block. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self} & \\
\hline
\end{DoxyParams}


Definition at line 543 of file blocks.\+f90.


\begin{DoxyCode}
543     \textcolor{keywordtype}{implicit none}
544     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
545     \textcolor{keywordtype}{type}(string) :: outext, temp\_str
546     \textcolor{keywordtype}{integer} :: i
547     temp\_str = self%id
548     outext=\textcolor{stringliteral}{'-->Block '}//temp\_str//\textcolor{stringliteral}{' is a'}
549     \textcolor{keyword}{call }log%put(outext,.false.)
550     \textcolor{keyword}{call }geometry%print(self%extents)
551     temp\_str = self%LSource%getSize()
552     outext=\textcolor{stringliteral}{'      and has '}//temp\_str//\textcolor{stringliteral}{' Sources'}
553     \textcolor{keyword}{call }log%put(outext,.false.)
554     \textcolor{keyword}{call }self%LSource%print()
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_ae3bd1bfeee831f4b41932839495bb108}\label{namespaceblocks__mod_ae3bd1bfeee831f4b41932839495bb108}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!putsource@{putsource}}
\index{putsource@{putsource}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{putsource()}{putsource()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::putsource (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self,  }\item[{class(\mbox{\hyperlink{structsources__mod_1_1source__class}{source\+\_\+class}}), intent(inout)}]{sourcetoadd }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to place a Source on the Block source\+List\+\_\+class object. Adds the Source info to the Block Emitter. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em self,sourcetoadd} & \\
\hline
\mbox{\tt in,out}  & {\em sourcetoadd} & Source object to store \\
\hline
\end{DoxyParams}


Definition at line 128 of file blocks.\+f90.


\begin{DoxyCode}
128     \textcolor{keywordtype}{implicit none}
129     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
130     \textcolor{keywordtype}{class}(source\_class), \textcolor{keywordtype}{intent(inout)} :: sourcetoadd
131     \textcolor{keyword}{call }self%LSource%add(sourcetoadd)
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a3245bdadbec6bb123c517921d1503b48}\label{namespaceblocks__mod_a3245bdadbec6bb123c517921d1503b48}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!runsolver@{runsolver}}
\index{runsolver@{runsolver}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{runsolver()}{runsolver()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::runsolver (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to run the solver on the data on this Block for the current timestep. Time for some actual numerical work! 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 399 of file blocks.\+f90.


\begin{DoxyCode}
399     \textcolor{keywordtype}{implicit none}
400     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
401     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%BlockState)) \textcolor{keywordflow}{then}             \textcolor{comment}{!There are Tracers in this Block}
402         \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%Background)) \textcolor{keywordflow}{then}    \textcolor{comment}{!There are Backgrounds in this Block}
403             \textcolor{comment}{!print*, 'From Block ', self%id}
404             \textcolor{keyword}{call }self%Solver%runStep(self%BlockState, self%Background, globals%SimTime%CurrTime, globals
      %SimDefs%dt)
405 \textcolor{keywordflow}{        end if}
406 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a1e632738786730731a48d9a432f6ab84}\label{namespaceblocks__mod_a1e632738786730731a48d9a432f6ab84}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!sendsource@{sendsource}}
\index{sendsource@{sendsource}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{sendsource()}{sendsource()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::sendsource (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{blk,  }\item[{class(\mbox{\hyperlink{structsources__mod_1_1source__class}{source\+\_\+class}}), intent(inout)}]{src }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to send a Source from the current Block to another Block. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em blk,src} & \\
\hline
\end{DoxyParams}


Definition at line 462 of file blocks.\+f90.


\begin{DoxyCode}
462     \textcolor{keywordtype}{implicit none}
463     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: blk
464     \textcolor{keywordtype}{class}(source\_class), \textcolor{keywordtype}{intent(inout)} :: src
465     \textcolor{keyword}{call }sblock(blk)%LSource%add(src)
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a1e632738786730731a48d9a432f6ab84_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a5a9992de40470e417ec8e40e688f6a0e}\label{namespaceblocks__mod_a5a9992de40470e417ec8e40e688f6a0e}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!sendtracer@{sendtracer}}
\index{sendtracer@{sendtracer}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{sendtracer()}{sendtracer()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::sendtracer (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{blk,  }\item[{class(tracer\+\_\+class), intent(inout)}]{trc }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to send a Tracer from the current Block to another Block. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em blk,trc} & \\
\hline
\end{DoxyParams}


Definition at line 447 of file blocks.\+f90.


\begin{DoxyCode}
447     \textcolor{keywordtype}{implicit none}
448     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: blk
449     \textcolor{keywordtype}{class}(tracer\_class), \textcolor{keywordtype}{intent(inout)} :: trc
450     \textcolor{comment}{!PARALLEL this is a CRITICAL section, need to ensure correct tracer}
451     \textcolor{comment}{!index attribution at the new block}
452     \textcolor{keyword}{call }sblock(blk)%LTracer%add(trc)
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a5a9992de40470e417ec8e40e688f6a0e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a8f5a5d9e6cfd16cfd1b179092a204696}\label{namespaceblocks__mod_a8f5a5d9e6cfd16cfd1b179092a204696}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!setblocks@{setblocks}}
\index{setblocks@{setblocks}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{setblocks()}{setblocks()}}
{\footnotesize\ttfamily subroutine, public blocks\+\_\+mod\+::setblocks (\begin{DoxyParamCaption}\item[{logical, intent(in)}]{auto,  }\item[{integer, intent(in)}]{nblk,  }\item[{integer, intent(out)}]{nxi,  }\item[{integer, intent(out)}]{nyi }\end{DoxyParamCaption})}



routine to set the simulation blocks extents and call the block initializer 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em auto,nblk,nxi,nyi} & \\
\hline
\end{DoxyParams}


Definition at line 564 of file blocks.\+f90.


\begin{DoxyCode}
564     \textcolor{keywordtype}{implicit none}
565     \textcolor{keywordtype}{logical}, \textcolor{keywordtype}{intent(in)} ::  auto
566     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} ::  nblk
567     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: nxi, nyi
568     \textcolor{keywordtype}{type}(string) :: outext, temp(2)
569     \textcolor{keywordtype}{integer} :: i, j, b
570     \textcolor{keywordtype}{real(prec)} :: ar
571     \textcolor{keywordtype}{type}(box) :: tempbox
572 
573     \textcolor{keywordflow}{if} (auto) \textcolor{keywordflow}{then}
574         ar = bbox%size%x/bbox%size%y
575         ar = utils%get\_closest\_twopow(ar) \textcolor{comment}{!aspect ratio of our bounding box}
576         nyi = sqrt(nblk/ar)
577         \textcolor{keywordflow}{if} (nblk == 1) nyi = 1
578         \textcolor{keywordflow}{if} (nyi == 0) \textcolor{keywordflow}{then}
579             temp(1) = ar
580             outext=\textcolor{stringliteral}{'[setBlocks]: block auto sizing failed. Bouding box aspect ratio = '}//temp(1)//\textcolor{stringliteral}{'.
       Stoping'}
581             \textcolor{keyword}{call }log%put(outext)
582             stop
583 \textcolor{keywordflow}{        endif}
584         nxi = (nblk/nyi)
585 
586         b=1
587         \textcolor{keywordflow}{do} i=1, nxi
588             \textcolor{keywordflow}{do} j=1, nyi
589                 tempbox%pt = bbox%pt + bbox%size%x*(i-1)/nxi*ex + bbox%size%y*(j-1)/nyi*ey
590                 tempbox%size = bbox%size%x/nxi*ex + bbox%size%y/nyi*ey + bbox%size%z*ez
591                 \textcolor{keyword}{call }sblock(b)%initialize(b, tempbox)
592                 b=b+1
593 \textcolor{keywordflow}{            end do}
594 \textcolor{keywordflow}{        end do}
595         temp(1) = nxi
596         temp(2) = nyi
597         outext=\textcolor{stringliteral}{'-->Automatic domain decomposition sucessful. Domain is '}//temp(1)// \textcolor{stringliteral}{' X '} //temp(2)//\textcolor{stringliteral}{'
       Blocks'}
598         \textcolor{keyword}{call }log%put(outext,.false.)
599 \textcolor{keywordflow}{    end if}
600     globals%SimDefs%blocksize = sblock(1)%extents%size
601     \textcolor{comment}{!do i=1, size(sBlock)}
602     \textcolor{comment}{!    call sBlock(i)%print()}
603     \textcolor{comment}{!enddo}
604 
605     \textcolor{keywordflow}{return}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a8f5a5d9e6cfd16cfd1b179092a204696_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_a04a9fab577b0d1fb6cabefcde2b2180d}\label{namespaceblocks__mod_a04a9fab577b0d1fb6cabefcde2b2180d}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!shedmemory@{shedmemory}}
\index{shedmemory@{shedmemory}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{shedmemory()}{shedmemory()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::shedmemory (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method that calls background functions to clean data no longer needed. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 273 of file blocks.\+f90.


\begin{DoxyCode}
273     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
274     \textcolor{keywordtype}{integer} :: i
275     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%Background)) \textcolor{keywordflow}{then}
276         \textcolor{keywordflow}{do} i=1, \textcolor{keyword}{size}(self%Background)
277             \textcolor{keyword}{call }self%Background(i)%ShedMemory()
278 \textcolor{keywordflow}{        end do}
279 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a306a753acc9b8bb9107ebda481162180}\label{namespaceblocks__mod_a306a753acc9b8bb9107ebda481162180}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!svtotracers@{svtotracers}}
\index{svtotracers@{svtotracers}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{svtotracers()}{svtotracers()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::svtotracers (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to write the data in the SV back to the Tracer objects in the list. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 415 of file blocks.\+f90.


\begin{DoxyCode}
415     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
416     \textcolor{keywordtype}{integer} :: i
417     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%BlockState)) \textcolor{keywordflow}{then}
418         \textcolor{keywordflow}{do} i=1, \textcolor{keyword}{size}(self%BlockState)
419             \textcolor{keyword}{call }self%BlockState(i)%toTracers()
420 \textcolor{keywordflow}{        end do}
421 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_ab9e57cbf0103b632b2b2dfa4e4d4139c}\label{namespaceblocks__mod_ab9e57cbf0103b632b2b2dfa4e4d4139c}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!toogleblocksources@{toogleblocksources}}
\index{toogleblocksources@{toogleblocksources}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{toogleblocksources()}{toogleblocksources()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::toogleblocksources (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to activate and deactivate the sources on this block, based on GlobalsSim\+TimeCurr\+Time. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 141 of file blocks.\+f90.


\begin{DoxyCode}
141     \textcolor{keywordtype}{implicit none}
142     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self
143     \textcolor{keywordtype}{integer} :: i, blk
144     \textcolor{keywordtype}{class}(*), \textcolor{keywordtype}{pointer} :: aSource
145     \textcolor{keywordtype}{type}(string) :: outext
146     \textcolor{keywordtype}{logical} :: notremoved
147 
148     \textcolor{keyword}{call }self%LSource%reset()                   \textcolor{comment}{! reset list iterator}
149     \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(self%LSource%moreValues())         \textcolor{comment}{! loop while there are values}
150         notremoved = .true.
151         asource => self%LSource%currentValue()  \textcolor{comment}{! get current value}
152         \textcolor{keywordflow}{select type}(asource)
153 \textcolor{keywordflow}{        class is} (source\_class)
154             asource%now%active = asource%par%activeTime(globals%Sim%getnumdt())
155             \textcolor{keywordflow}{if} (asource%now%active) \textcolor{keywordflow}{then}
156                 \textcolor{keywordflow}{if} (.not.asource%par%fixed\_position) \textcolor{keywordflow}{then}
157                     \textcolor{comment}{!check if in the domain}
158                     asource%now%active = trcinbbox(asource%now%pos, bbox)
159                     \textcolor{keywordflow}{if} (asource%now%active) \textcolor{keywordflow}{then}
160                         \textcolor{comment}{!check if in this block}
161                         blk = getblockindex(asource%now%pos)
162                         \textcolor{keywordflow}{if} (blk /= self%id) \textcolor{keywordflow}{then}        \textcolor{comment}{!Source is on a different block than the current
       one                        }
163                             \textcolor{keyword}{call }sendsource(blk,asource)
164                             \textcolor{keyword}{call }self%LSource%removeCurrent() \textcolor{comment}{!this also advances the iterator to the next
       position}
165                             notremoved = .false.
166 \textcolor{keywordflow}{                        end if}
167 \textcolor{keywordflow}{                    end if}
168 \textcolor{keywordflow}{                end if}
169 \textcolor{keywordflow}{            end if}
170 \textcolor{keywordflow}{            class default}
171             outext = \textcolor{stringliteral}{'[Block::ToogleBlockSources] Unexepected type of content, not a Source'}
172             \textcolor{keyword}{call }log%put(outext)
173             stop
174 \textcolor{keywordflow}{        end select}
175         \textcolor{keywordflow}{if} (notremoved) \textcolor{keyword}{call }self%LSource%next()            \textcolor{comment}{! increment the list iterator}
176 \textcolor{keywordflow}{    end do}
177     \textcolor{keyword}{call }self%LSource%reset()               \textcolor{comment}{! reset list iterator}
178 
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_ab9e57cbf0103b632b2b2dfa4e4d4139c_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceblocks__mod_aa9c438503e619aa4352081ff46b15430}\label{namespaceblocks__mod_aa9c438503e619aa4352081ff46b15430}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!tracerstosv@{tracerstosv}}
\index{tracerstosv@{tracerstosv}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{tracerstosv()}{tracerstosv()}}
{\footnotesize\ttfamily subroutine blocks\+\_\+mod\+::tracerstosv (\begin{DoxyParamCaption}\item[{class(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), intent(inout)}]{self }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Method to build the State Vector at this timestep for actual numerical work. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}


Definition at line 288 of file blocks.\+f90.


\begin{DoxyCode}
288     \textcolor{keywordtype}{class}(block\_class), \textcolor{keywordtype}{intent(inout)} :: self    
289     \textcolor{keywordtype}{integer} :: i, tType, idx
290     \textcolor{keywordtype}{class}(*), \textcolor{keywordtype}{pointer} :: aTracer
291     \textcolor{keywordtype}{logical} :: builtState, notFound
292     \textcolor{keywordtype}{type}(string) :: outext
293     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:,:)} :: tempTrcType
294     
295     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%trcType)) \textcolor{keyword}{deallocate}(self%trcType)
296     \textcolor{keyword}{call }self%LTracer%reset()                   \textcolor{comment}{! reset list iterator}
297     \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(self%LTracer%moreValues())         \textcolor{comment}{! loop while there are values}
298         notfound = .true.
299         atracer => self%LTracer%currentValue()  \textcolor{comment}{! get current value}
300         \textcolor{keywordflow}{select type}(atracer)
301 \textcolor{keywordflow}{        class is} (tracer\_class)
302                 ttype = atracer%par%ttype
303                 \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%trcType)) \textcolor{keywordflow}{then}
304                     \textcolor{keywordflow}{do} i =1, \textcolor{keyword}{size}(self%trcType,1)
305                         \textcolor{keywordflow}{if} (self%trcType(i,1) == ttype) \textcolor{keywordflow}{then}
306                             self%trcType(i,2) = self%trcType(i,2) + 1
307                             notfound = .false.
308                             \textcolor{keywordflow}{exit}
309 \textcolor{keywordflow}{                        end if}
310 \textcolor{keywordflow}{                    end do}
311 \textcolor{keywordflow}{                end if}
312                 \textcolor{keywordflow}{if} (notfound) \textcolor{keywordflow}{then}
313                     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%trcType)) \textcolor{keywordflow}{then}
314                         \textcolor{keyword}{allocate}(temptrctype(\textcolor{keyword}{size}(self%trcType,1),\textcolor{keyword}{size}(self%trcType,2)))
315                         temptrctype = self%trcType
316                         \textcolor{keyword}{deallocate}(self%trcType)
317                         \textcolor{keyword}{allocate}(self%trcType(\textcolor{keyword}{size}(temptrctype,1)+1,\textcolor{keyword}{size}(temptrctype,2)))
318                         self%trcType(:\textcolor{keyword}{size}(temptrctype,1),:) = temptrctype
319                         \textcolor{keyword}{deallocate}(temptrctype)
320                         idx = \textcolor{keyword}{size}(self%trcType,1)
321                     \textcolor{keywordflow}{else}
322                         \textcolor{keyword}{allocate}(self%trcType(1,3))
323                         idx = 1
324 \textcolor{keywordflow}{                    end if}
325                     self%trcType(idx,1) = ttype
326                     self%trcType(idx,2) = 1
327                     self%trcType(idx,3) = atracer%getNumVars()
328 \textcolor{keywordflow}{                end if}
329 \textcolor{keywordflow}{            class default}
330             outext = \textcolor{stringliteral}{'[Block::TracersToSV]: Unexepected type of content, not a Tracer'}
331             \textcolor{keyword}{call }log%put(outext)
332             stop
333 \textcolor{keywordflow}{        end select}
334         \textcolor{keyword}{call }self%LTracer%next()    \textcolor{comment}{! increment the list iterator}
335 \textcolor{keywordflow}{    end do}
336     \textcolor{keyword}{call }self%LTracer%reset()                       \textcolor{comment}{! reset list iterator}
337     
338     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(self%trcType)) \textcolor{keywordflow}{then}
339         \textcolor{keyword}{allocate}(self%BlockState(\textcolor{keyword}{size}(self%trcType,1)))
340         \textcolor{keywordflow}{do} i=1, \textcolor{keyword}{size}(self%BlockState)
341             self%BlockState(i)%idx = 1
342             self%BlockState(i)%ttype = self%trcType(i,1)
343             \textcolor{keyword}{allocate}(self%BlockState(i)%state(self%trcType(i,2),self%trcType(i,3)))
344             \textcolor{keyword}{allocate}(self%BlockState(i)%trc(self%trcType(i,2)))
345             \textcolor{keyword}{allocate}(self%BlockState(i)%active(self%trcType(i,2)))
346             \textcolor{keyword}{allocate}(self%BlockState(i)%source(self%trcType(i,2)))
347             \textcolor{keyword}{allocate}(self%BlockState(i)%id(self%trcType(i,2)))
348             \textcolor{keyword}{allocate}(self%BlockState(i)%landIntMask(self%trcType(i,2)))            
349             self%BlockState(i)%landIntMask = globals%Mask%waterVal
350             \textcolor{keyword}{allocate}(self%BlockState(i)%resolution(self%trcType(i,2)))
351 \textcolor{keywordflow}{        end do}
352         \textcolor{keyword}{call }self%LTracer%reset()                   \textcolor{comment}{! reset list iterator}
353         \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(self%LTracer%moreValues())         \textcolor{comment}{! loop while there are values}
354             builtstate = .false.
355             atracer => self%LTracer%currentValue()  \textcolor{comment}{! get current value}
356             \textcolor{keywordflow}{select type}(atracer)
357 \textcolor{keywordflow}{            class is} (tracer\_class)
358                 ttype = atracer%par%ttype
359                 \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(self%BlockState)
360                     \textcolor{keywordflow}{if} (ttype == self%BlockState(i)%ttype) \textcolor{keywordflow}{then}
361                         self%BlockState(i)%state(self%BlockState(i)%idx,:) = atracer%getStateArray()
362                         self%BlockState(i)%source(self%BlockState(i)%idx) = atracer%par%idsource
363                         self%BlockState(i)%id(self%BlockState(i)%idx) = atracer%par%id
364                         self%BlockState(i)%active(self%BlockState(i)%idx) = atracer%now%active
365                         self%BlockState(i)%trc(self%BlockState(i)%idx)%ptr => atracer
366                         self%BlockState(i)%idx = self%BlockState(i)%idx + 1
367                         \textcolor{keywordflow}{if}(.not.\textcolor{keyword}{allocated}(self%BlockState(i)%varName)) \textcolor{keywordflow}{then}
368                             \textcolor{keyword}{allocate}(self%BlockState(i)%varName(atracer%getNumVars()))
369                             self%BlockState(i)%varName = atracer%varName
370 \textcolor{keywordflow}{                        end if}
371                         builtstate = .true.
372                         \textcolor{keywordflow}{exit}
373 \textcolor{keywordflow}{                    end if}
374 \textcolor{keywordflow}{                end do}
375                 atracer%now%active = .false. \textcolor{comment}{!only gets flaged as active if the state vector says so when
       copying back to the Tracers}
376                 \textcolor{keywordflow}{if} (.not.builtstate) \textcolor{keywordflow}{then}
377                     outext = \textcolor{stringliteral}{'[Block::TracersToSV]: Tracer did not find correspoding State Vector, stoping'}
378                     \textcolor{keyword}{call }log%put(outext)
379                     stop
380 \textcolor{keywordflow}{                end if}
381 \textcolor{keywordflow}{                class default}
382                 outext = \textcolor{stringliteral}{'[Block::TracersToSV]: Unexepected type of content, not a Tracer'}
383                 \textcolor{keyword}{call }log%put(outext)
384                 stop
385 \textcolor{keywordflow}{            end select}
386             \textcolor{keyword}{call }self%LTracer%next()    \textcolor{comment}{! increment the list iterator}
387 \textcolor{keywordflow}{        end do}
388         \textcolor{keyword}{call }self%LTracer%reset()                       \textcolor{comment}{! reset list iterator}
389 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceblocks__mod_a101d0a23b5b56baf6e5bd35bc7b677b0}\label{namespaceblocks__mod_a101d0a23b5b56baf6e5bd35bc7b677b0}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!trcinbbox@{trcinbbox}}
\index{trcinbbox@{trcinbbox}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{trcinbbox()}{trcinbbox()}}
{\footnotesize\ttfamily logical function blocks\+\_\+mod\+::trcinbbox (\begin{DoxyParamCaption}\item[{type(vector), intent(in)}]{trc,  }\item[{type(\mbox{\hyperlink{structboundingbox__mod_1_1boundingbox__class}{boundingbox\+\_\+class}}), intent(inout)}]{testbox }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Returns true if the point is inside the requested bounding box. 

\begin{DoxyAuthor}{Author}
Ricardo Birjukovs Canelas -\/ M\+A\+R\+E\+T\+EC 
\end{DoxyAuthor}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em trc,testbox} & \\
\hline
\end{DoxyParams}


Definition at line 498 of file blocks.\+f90.


\begin{DoxyCode}
498     \textcolor{keywordtype}{implicit none}
499     \textcolor{keywordtype}{type}(vector), \textcolor{keywordtype}{intent(in)} :: trc
500     \textcolor{keywordtype}{type}(boundingbox\_class), \textcolor{keywordtype}{intent(inout)} :: testbox
501     trcinbbox = .false.
502     \textcolor{keywordflow}{if} (trc%x >= testbox%pt%x) \textcolor{keywordflow}{then}
503         \textcolor{keywordflow}{if} (trc%x <= testbox%pt%x + testbox%size%x) \textcolor{keywordflow}{then}
504             \textcolor{keywordflow}{if} (trc%y >= testbox%pt%y) \textcolor{keywordflow}{then}
505                 \textcolor{keywordflow}{if} (trc%y <= testbox%pt%y + testbox%size%y) \textcolor{keywordflow}{then}
506                     \textcolor{keywordflow}{if} (trc%z >= testbox%pt%z) \textcolor{keywordflow}{then}
507                         \textcolor{keywordflow}{if} (trc%z <= testbox%pt%z + testbox%size%z) \textcolor{keywordflow}{then}
508                             trcinbbox = .true.
509 \textcolor{keywordflow}{                        end if}
510 \textcolor{keywordflow}{                    end if}
511 \textcolor{keywordflow}{                end if}
512 \textcolor{keywordflow}{            end if}
513 \textcolor{keywordflow}{        end if}
514 \textcolor{keywordflow}{    end if}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceblocks__mod_a101d0a23b5b56baf6e5bd35bc7b677b0_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceblocks__mod_a13b3fc755dfbf3e333490a3f931b28aa}\label{namespaceblocks__mod_a13b3fc755dfbf3e333490a3f931b28aa}} 
\index{blocks\+\_\+mod@{blocks\+\_\+mod}!sblock@{sblock}}
\index{sblock@{sblock}!blocks\+\_\+mod@{blocks\+\_\+mod}}
\subsubsection{\texorpdfstring{sblock}{sblock}}
{\footnotesize\ttfamily type(\mbox{\hyperlink{structblocks__mod_1_1block__class}{block\+\_\+class}}), dimension(\+:), allocatable, public blocks\+\_\+mod\+::sblock}



Definition at line 70 of file blocks.\+f90.


\begin{DoxyCode}
70     \textcolor{keywordtype}{type}(block\_class), \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{dimension(:)} :: sBlock
\end{DoxyCode}
